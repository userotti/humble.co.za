var hipmob=hipmob||function(){var self={};var q=false;var tab=false;var initial_focus_timer=false;var chatlog=false;var id_app=false,user_id=false,group_id=false;var use_placeholder="placeholder"in document.createElement("input");var prechatform=false,postchatform=false,awayform=false,chatform=false,branding=false,queueform=false,surveyframe=false,emailform=false;var titlebar=false,textinput=false,inputcontainer=false,inputblock=false,titletext=false,restartchatcontainer=false,restartchatbutton=false;var prechatinput_name=false,prechatinput_email=false,prechatinput_question=false,prechatform_message=false;var typingindicator=false;var session_defaults=false;var last_text="";var is_open=false;var default_left;var default_height=350,default_tab_height=30,default_tab_width=300,default_tab_offset=100;var branding_height=-1,min_default_tab_width=240,min_default_widget_height=275;var min_default_tab_offset=50,min_default_tab_height=24,default_border_width=1;var host_height_monitor_timer=null,last_host_height=null;var chat_settings={fullscreen:false};var notification_settings={};var tab_settings={},input_settings={},icon_settings=false,status_settings={},control_settings={},typing_indicator_settings={};var disable_autoscroll=false;var popout_window=false,popout_check_timer=false;var user_name=false,user_email=false,user_context=false,user_context_properties=false,user_phone=false;var has_focus=false,top_offset=0;var prechat_form_shrink_setup=false;var crossdomain=false;var info_button_label=false;var loadfunc=false,preloadfunc=false,savesessionfunc=false,restoresessionfunc=false;var renderfunc=false;var urlRegex=/^((http:|https:|file:)?\/\/(\w+:{0,1}\w*@)?(\S+)|)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/;var defaultstyle='div.hipmob_tab{position:fixed;cursor:pointer;z-index:100000;font-size:14px;vertical-align:middle;overflow:hidden;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box}div.hipmob_tab div.hipmob_titlebar{vertical-align:middle}div.hipmob_tab div.hipmob_titlebar div.hipmob_title{white-space:nowrap;text-overflow:ellipsis}div.hipmob_tab div.hipmob_branding{width:100%}div.hipmob_chat{position:relative;margin:6px auto}div.def_hm_style{font-family:verdana;font-size:14px;background-color:#FFF;border-color:#787878;border-style:solid;border-top-width:0;border-bottom-width:0;border-left-width:0;border-right-width:0;-webkit-tap-highlight-color:rgba(0,0,0,0)}div.def_hm_style div.hipmob_titlebar{color:#383838;padding-left:3px;padding-right:3px;text-align:left}div.def_hm_style div.hipmob_branding{margin:0 auto;text-align:center;border-top:1px solid #dedede;line-height:10px;font-size:10px;padding-top:2px;padding-bottom:2px;margin-top:3px;margin-bottom:2px;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;color:#606060;clear:both}div.def_hm_style div.hipmob_branding a,div.def_hm_style div.hipmob_branding a:visited,div.def_hm_style div.hipmob_branding a:active{color:#606060;text-decoration:none}div.def_hm_style div.hipmob_branding a:hover{color:#606060;text-decoration:underline}div.def_hm_style div.hmmsgme{text-align:left;margin-left:6px;line-height:24px}div.def_hm_style div.hmmsgme span.hmfrom{color:#757449;font-weight:700}div.def_hm_style div.hmmsgme span.hmtxt{color:#303030}div.def_hm_style div.hmmsgapp{text-align:left;margin-left:6px;line-height:24px}div.def_hm_style div.hmmsgapp span.hmfrom{color:#4B490B;font-weight:700}div.def_hm_style div.hmmsgapp span.hmtxt{color:#303030}div.hipmob_log{margin:6px auto;overflow-y:auto;overflow-x:hidden;scrollbar-face-color:#369;scrollbar-3dlight-color:#369;scrollbar-base-color:#369;scrollbar-track-color:#369;scrollbar-darkshadow-color:#000;scrollbar-arrow-color:#000;scrollbar-shadow-color:#fff;scrollbar-highlight-color:#fff}div.hipmob_window_button{float:right;display:none;border-width:0 solid #000}@media only screen and (max-width:760px){div.hipmob_log_spacer{display:none}}@media only screen and (max-width:760px){div.hipmob_mobile_detector{display:none}}div.hipmob_input_container{margin:6px auto;padding-left:5px;padding-right:8px}table.hipmob_input_table{width:100%;margin:0;padding:0;border:0;border-spacing:0;border-collapse:collapse}table.hipmob_input_table>tr{margin:0;padding:0}table.hipmob_input_table>tr>td{margin:0;padding:0}div.hipmob_input_block{padding:0}button.hipmob_send_button{float:right;overflow:hidden}div.hipmob_input_block form{padding:0;margin:0 auto}textarea.hipmob_input{border:1px solid #CCC;box-shadow:0 1px 1px rgba(0,0,0,.075) inset;border-radius:3px;outline:0 none;overflow:auto;width:100%;line-height:16px;padding:0;font-size:14px;font-weight:400;margin:0}.hmicon{display:block;width:24px;height:23px;margin-top:0;margin-right:0;line-height:16px;font-size:14px;vertical-align:middle;background-image:url(https://hipmob.s3.amazonaws.com/assets/img/chatsprites.png);background-position:0 0;background-repeat:no-repeat;color:#fff;padding-top:2px;float:left}.hmicon_close{background-position:-25px 0}.hmicon_open{background-position:-50px -25px}.hmicon_redblank{background-position:-75px 0}.hmicon_redblank_top{background-position:-75px -25px}.hmicon_online{background-position:-50px 0}.hmicon_offline{background-position:-25px -25px}.hmicon_disconnected{background-position:0 -25px}.hmicon_popout{background-position:0 -50px}.hmicon_email{background-position:-25px -50px}.hmicon_clean{background-position:0 0}.hmicon_modal_close{background-position:0 -25px;float:none;position:absolute;top:10px;right:10px}div.hipmob_custom_icon_block{display:none;vertical-align:middle;padding-left:0;padding-right:0;padding-top:0;padding-bottom:0;margin-top:0;margin-right:0;margin-left:0;margin-bottom:0;float:left}img.hipmob_custom_icon{margin-right:3px;vertical-align:middle;border:0 solid #000}div.hipmob_status_icon{border:0}div.hipmob_status_icon_block{vertical-align:middle;padding-left:0;padding-right:0;padding-top:0;padding-bottom:0;margin-top:0;margin-right:0;margin-left:0;margin-bottom:0;float:left;text-align:center}div.hipmob_openclose_block{float:right}div.hipmob_popout_block{float:right}div.hipmob_email_transcript{float:right}.hipmob_hide{display:none}.hipmob_closed{display:none}div.hipmob_info{position:relative;margin:6px auto;padding-top:10px;padding-left:5px;padding-right:5px;padding-bottom:10px}div.hipmob_info form div{margin-left:6px;margin-right:6px;margin-bottom:5px}div.hipmob_email{position:relative;margin:6px auto;padding-top:10px;padding-left:5px;padding-right:5px;padding-bottom:10px}div.hipmob_email form div{margin-left:6px;margin-right:6px;margin-bottom:5px}.hipmob_input{background-color:#FFF;border:1px solid #CCC;box-shadow:0 1px 1px rgba(0,0,0,.075) inset;transition:border .2s linear 0s,box-shadow .2s linear 0s;border-radius:4px;vertical-align:middle;padding:4px 6px;font-size:14px}.hipmob_input_required{border:1px solid red}.hipmob_class_textarea{width:96%;height:42px}.hipmob_class_input{height:20px;line-height:20px;width:96%}.hipmob_class_input:focus,.hipmob_class_textarea:focus{border-color:rgba(0,204,102,.8);outline:0;outline:thin dotted 9;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(0,204,102,.6);-moz-box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(0,204,102,.6);box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(0,204,102,.6)}.hipmob_input_required:focus{border-color:rgba(255,0,0,.8);outline:0;outline:thin dotted 9;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(255,0,0,.6);-moz-box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(255,0,0,.6);box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(255,0,0,.6)}.hipmob_class_button{border-color:rgba(0,0,0,.15) rgba(0,0,0,.15) rgba(0,0,0,.25);-moz-border-bottom-colors:none;-moz-border-left-colors:none;-moz-border-right-colors:none;-moz-border-top-colors:none;background-color:#F5F5F5;background-image:linear-gradient(to bottom,#FFF,#E6E6E6);background-repeat:repeat-x;border-color:rgba(0,0,0,.1) rgba(0,0,0,.1) #A2A2A2;border-image:none;border-radius:4px;border-style:solid;border-width:1px;box-shadow:0 1px 0 rgba(255,255,255,.2) inset,0 1px 2px rgba(0,0,0,.05);color:#333;cursor:pointer;display:inline-block;font-size:14px;line-height:20px;margin-bottom:0;padding:4px 12px;text-align:center;text-shadow:0 1px 1px rgba(255,255,255,.75);vertical-align:middle;float:right}.hipmob_class_button:focus{outline:thin dotted #333;outline-offset:-2px}div.hipmob_offline_form{margin-top:8px;margin-left:5px;margin-right:5px}div.hipmob_restartchat{bottom:0;padding-right:10px;margin-top:2px;margin-bottom:2px}div.hipmob_titlebar{background-color:#75add8;overflow:hidden;white-space:nowrap}div.hmmsgtyping{text-align:left;margin-left:6px;line-height:16px;color:gray;font-size:.8em}div.hipmob_title{float:left;white-space:nowrap;overflow:hidden;margin-left:3px}div.hipmob_popout_button{float:right;border-width:0 solid #000}div.hipmob_email_transcript_button{float:right;border-width:0 solid #000}';var autofills={email:{name:"Your name?",email:"Your email address?"},info:{name:"Your name?",email:"Your email address?",phone:"Your phone number?",question:"How can we help?"},offline:{name:"Your name?",email:"Your email address?",phone:"Your phone number?",question:"How can we help?"}};var calc_heights=false;var page_secure="https"===document.location.href.substring(0,5);var asset_host="hipmob.s3.amazonaws.com";var chat_title="Live Help";var service=false;var loaded=false;var chat_loaded=false;var css_loaded=false;var scroll_timer=false;var waiting_count=0;var iconstatus,windowbutton,popoutbutton,emailtranscriptbutton,sendbutton=null;var unloaded=false;var is_mobile=false;var is_iframe=false;var numbers=/^[\d]+$/;var recipient=false;var queried_generate_events=false,generate_events_mixpanel=false,generate_events_ga=false,processed_transcript=false;var post_process_transcript=false;var STATUS_DISCONNECTED=0;var STATUS_CONNECTED=1;var STATUS_OFFLINE=2;var STATUS_ONLINE=3;var status=STATUS_DISCONNECTED;var peerstatus={};var initiated=false,operator=false;var appname=false;var position="bottomright",use_top=false,use_left=false,use_center=false;var pendingmsg_icon_class="hmicon_redblank";var pending_tasks=[];var resize_on_show=false;var host=false;var env=false;var loader=false;var chrome_port=false;var user_label="Me";var input_placeholder="How can we help?";var greeting=false;var away_message=false,away_greeting=false,away_title=false;var away_displayed=false,greeting_displayed=false;var info_cookie_name=false,crossdomain_info_cookie_name=false;var open_cookie_name="_hipmob_tab_open_";var typeahead_timer=false;var sid=false;var modal_options={overlayCss:{"background-color":"#000"},containerCss:{height:"360px",width:"600px",color:"#bbb","background-color":"#ffffff",border:"1px solid #444",padding:"12px"},dataCss:{padding:"8px"},escClose:false};var email_re=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i;var phone_re=/[0-9]{7,}/;if(!("console"in window))window.console={};if(!("log"in window.console))window.console.log=function(input){};var slice=function(str,start,end){var len=str.length;if(start<0)start=len+start;if(end<0)end=len+end;return str.substring(start,end)};var get_bounds_value=function(source_value,accept_percentages){if(typeof source_value=="number"){return source_value}else if(typeof source_value=="string"&&"px"==slice(source_value,-2)){var nw=source_value.replace("px","");if(numbers.test(nw))return parseInt(nw)}else if(accept_percentages){if(typeof source_value=="string"&&"%"==slice(source_value,-2)){return source_value}}return false};var endsWith=function(stack,needle){return stack.length>=needle.length&&slice(stack,stack.length-needle.length)==needle};var b=self,c={},d=null,e=null,f=null;b.addListener=function(a,d){c[a]?c[a].push(d):c[a]=[d];b.emit("newListener",a,d);return b};b.on=b.addListener;b.emit=function(a){if(c[a]){e=Array.prototype.slice.call(arguments,1);for(d=0;d<c[a].length;d+=1)c[a][d].apply(null,e)}return b};b.listeners=function(a){c[a]||(c[a]=[]);return c[a]};b.once=function(a,c){function d(){c.apply(null,arguments);b.removeListener(a,d)}b.addListener(a,d);return b};b.removeListener=function(a,e){if(c[a]){a:{var g=c[a];if(g.indexOf)f=g.indexOf(e);else{for(d=0;d<g.length;d+=1)if(g[d]===e){f=d;break a}f=-1}}f!==-1&&c[a].splice(f,1)}else c[a]=[];return b};b.off=b.removeListener;b.removeAllListeners=function(a){c[a]=[];return b};self["complete_css_load"]=function(css,callback){if(css_loaded)return;css_loaded=true;var head=document.getElementsByTagName("head")[0],style=document.createElement("style");style.type="text/css";style.id="hipmob_css";if(style.styleSheet){style.styleSheet.cssText=css}else{style.appendChild(document.createTextNode(css))}head.appendChild(style);if(loaded){q(callback?callback:load_hipmob)}else{q(window).on("load",callback?callback:load_hipmob);setTimeout(function(){q(callback?callback:load_hipmob)},2e3)}};var load_css=function(path,callback){if(defaultstyle==="<chatstylereplace>"){var csspath=path;q.ajax({url:csspath,success:function(css,status){self.complete_css_load(css,callback)},error:function(xhr,status,err){q.ajax({url:csspath+".jsonp?callback=?",dataType:"jsonp",jsonpCallback:"hipmob.complete_css_load",success:function(data){self.complete_css_load(css,callback)}})},dataType:"text"})}else{self.complete_css_load(defaultstyle,callback)}};var linkify=function(){var SCHEME="(?:[a-z\\d.-]+://|tel:|sms:)",IPV4="(?:(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])\\.){3}(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])",HOSTNAME="(?:(?:[^\\s!@#$%^&*()_=+[\\]{}\\\\|;:'\",.<>/?]+)\\.)+",TLD="(?:ac|ad|aero|ae|af|ag|ai|al|am|an|ao|aq|arpa|ar|asia|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|biz|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|cat|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|coop|com|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|edu|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gov|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|info|int|in|io|iq|ir|is|it|je|jm|jobs|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mil|mk|ml|mm|mn|mobi|mo|mp|mq|mr|ms|mt|museum|mu|mv|mw|mx|my|mz|name|na|nc|net|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|org|pa|pe|pf|pg|ph|pk|pl|pm|pn|pro|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tel|tf|tg|th|tj|tk|tl|tm|tn|to|tp|travel|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|xn--0zwm56d|xn--11b5bs3a9aj6g|xn--80akhbyknj4f|xn--9t4b11yi5a|xn--deba0ad|xn--g6w251d|xn--hgbk6aj7f53bba|xn--hlcj6aya9esc7a|xn--jxalpdlp|xn--kgbechtv|xn--zckzah|ye|yt|yu|za|zm|zw)",HOST_OR_IP="(?:"+HOSTNAME+TLD+"|"+IPV4+")",PATH="(?:[;/][^#?<>\\s]*)?",QUERY_FRAG="(?:\\?[^#<>\\s]*)?(?:#[^<>\\s]*)?",URI1="\\b"+SCHEME+"[^<>\\s]+",URI2="\\b"+HOST_OR_IP+PATH+QUERY_FRAG+"(?!\\w)",MAILTO="mailto:",EMAIL="(?:"+MAILTO+")?[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@"+HOST_OR_IP+QUERY_FRAG+"(?!\\w)",URI_RE=new RegExp("(?:"+URI1+"|"+URI2+"|"+EMAIL+")","ig"),SCHEME_RE=new RegExp("^"+SCHEME,"i"),quotes={"'":"`",">":"<",")":"(","]":"[","}":"{","»":"«","›":"‹"},default_options={callback:function(text,href){return href?'<a href="'+href+'" title="'+href+'">'+text+"</a>":text},punct_regexp:/(?:[!?.,:;'"]|(?:&|&amp;)(?:lt|gt|quot|apos|raquo|laquo|rsaquo|lsaquo);)$/};return function(txt,options){options=options||{};var arr,i,link,href,html="",parts=[],idx_prev,idx_last,idx,link_last,matches_begin,matches_end,quote_begin,quote_end;for(i in default_options){if(options[i]===undefined){options[i]=default_options[i]}}while(arr=URI_RE.exec(txt)){link=arr[0];idx_last=URI_RE.lastIndex;idx=idx_last-link.length;if(/[\/:]/.test(txt.charAt(idx-1))){continue}do{link_last=link;quote_end=slice(link,-1);quote_begin=quotes[quote_end];if(quote_begin){matches_begin=link.match(new RegExp("\\"+quote_begin+"(?!$)","g"));matches_end=link.match(new RegExp("\\"+quote_end,"g"));if((matches_begin?matches_begin.length:0)<(matches_end?matches_end.length:0)){link=slice(link,0,link.length-1);idx_last--}}if(options.punct_regexp){link=link.replace(options.punct_regexp,function(a){idx_last-=a.length;return""})}}while(link.length&&link!==link_last);href=link;if(!SCHEME_RE.test(href)){href=(href.indexOf("@")!==-1?!href.indexOf(MAILTO)?"":MAILTO:!href.indexOf("irc.")?"irc://":!href.indexOf("ftp.")?"ftp://":"http://")+href}if(idx_prev!=idx){parts.push([slice(txt,idx_prev,idx)]);idx_prev=idx_last}parts.push([link,href])}parts.push([slice(txt,idx_prev)]);for(i=0;i<parts.length;i++){html+=options.callback.apply(window,parts[i])}return html||txt}}();var generate_event=function(name,operator){if(generate_events_mixpanel){if("mixpanel"in window){var properties={};properties["Hipmob App ID"]=service.app;properties["Hipmob App Name"]=appname;if(operator)properties["Hipmob Operator"]=operator;var u=service.user();if(u)properties["Hipmob User ID"]=u;window.mixpanel.track(name,properties)}}if(generate_events_ga){var label=appname;if(operator)label=appname+" - "+operator;if("_gaq"in window)window._gaq.push(["_trackEvent","Hipmob",name,label])}};var scroll_to_bottom=function(){chatlog.animate({scrollTop:chatlog.prop("scrollHeight")},"fast")};var get_view_port=function(){var e=window,a="inner";if(!("innerWidth"in window)){a="client";e=document.documentElement||document.body}return{width:e[a+"Width"],height:e[a+"Height"]}};var get_margin_height=function(){var i,l=arguments.length,ret=0;for(i=0;i<l;i++){ret=ret+get_bounds_value(arguments[i].css("margin-top"))+get_bounds_value(arguments[i].css("margin-bottom"))}return ret};var get_margin_width=function(){var i,l=arguments.length,ret=0;for(i=0;i<l;i++){ret=ret+get_bounds_value(arguments[i].css("margin-left"))+get_bounds_value(arguments[i].css("margin-right"))}return ret};var get_padding_height=function(){var i,l=arguments.length,ret=0;for(i=0;i<l;i++){ret=ret+get_bounds_value(arguments[i].css("padding-top"))+get_bounds_value(arguments[i].css("padding-bottom"))}return ret};var get_padding_width=function(){var i,l=arguments.length,ret=0;for(i=0;i<l;i++){ret=ret+get_bounds_value(arguments[i].css("padding-left"))+get_bounds_value(arguments[i].css("padding-right"))}return ret};var get_border_height=function(){var i,l=arguments.length,ret=0;for(i=0;i<l;i++){ret=ret+get_bounds_value(arguments[i].css("border-top-width"))+get_bounds_value(arguments[i].css("border-bottom-width"))}return ret};var get_border_width=function(){var i,l=arguments.length,ret=0;for(i=0;i<l;i++){ret=ret+get_bounds_value(arguments[i].css("border-left-width"))+get_bounds_value(arguments[i].css("border-right-width"))}return ret};var show_only=function(target,noresize){if(target)target.removeClass("hipmob_hide");if(emailform&&target!=emailform)emailform.addClass("hipmob_hide");if(prechatform&&target!=prechatform)prechatform.addClass("hipmob_hide");if(postchatform&&target!=postchatform)postchatform.addClass("hipmob_hide");if(awayform&&target!=awayform)awayform.addClass("hipmob_hide");if(chatform&&target!=chatform)chatform.addClass("hipmob_hide");if(queueform&&target!=queueform)queueform.addClass("hipmob_hide");if(noresize)return;resize_chat(false,true)};var resize_chat=function(resize,refocus){var win=q(window),w=win.width(),h=win.height(),view=get_view_port();if(is_open){if(chatlog.scrollTop()+chatlog.height()==chatlog.prop("scrollHeight")){if(scroll_timer)clearTimeout(scroll_timer);scroll_timer=setTimeout(scroll_to_bottom,100)}var css={};if(host){default_tab_width=host.outerWidth()-get_padding_height(host)-get_border_width(host)-get_border_height(host)-get_padding_width(host);default_height=host.height()-get_padding_height(host)-get_margin_height(host);var css={width:default_tab_width+"px"};if(resize)css["height"]=default_height;tab.css(css);if(resize){var available_space=css["height"]-titlebar.outerHeight()-get_margin_height(titlebar);if(!branding.hasClass("hipmob_hide")){if(branding_height==-1){branding_height=branding.outerHeight()+get_margin_height(branding)}available_space-=branding_height}var log_height=available_space-inputcontainer.outerHeight()-get_margin_height(chatlog,inputcontainer);chatlog.css("max-height",log_height+"px");chatlog.data("max-height",log_height)}}else if(chat_settings.fullscreen){css={top:"0px",left:"0px",height:"100%",width:w-2*default_border_width}}else{css={height:default_height+"px"};if(use_top){css["top"]="0px";prechatform.removeClass("hipmob_closed");postchatform.removeClass("hipmob_closed");awayform.removeClass("hipmob_closed")}else{css["bottom"]="0px"}if(resize){if(use_left){default_left=default_tab_offset}else{default_left=w-default_tab_width-default_tab_offset;if(default_left<0)default_left=0;if(default_left+default_tab_width>w)default_tab_width=w;if(default_tab_width<min_default_tab_width)default_tab_width=min_default_tab_width}if(use_center){css["margin-left"]="-"+default_tab_width/2+"px";css["left"]="50%"}else{css["left"]=default_left+"px"}css["width"]=default_tab_width+"px"}}tab.animate(css,250,function(){if(use_top){chatform.css("margin-top","");if(surveyframe)surveyframe.css("margin-top","")}var available_space=tab.height()-titlebar.outerHeight()-get_margin_height(titlebar);if(!branding.hasClass("hipmob_hide")){if(branding_height==-1){branding_height=branding.outerHeight()+get_margin_height(branding)}available_space-=branding_height}var log_height=available_space-inputcontainer.outerHeight()-get_margin_height(chatlog,inputcontainer);chatlog.css("max-height",log_height+"px");chatlog.data("max-height",log_height);if(is_mobile){if(chatlog.height()<log_height){q("div#hipmob_log_spacer").css({height:log_height-chatlog.height()+"px",display:"block"})}else{q("div#hipmob_log_spacer").css("display","none")}}else{chatlog.css("height",log_height+"px")}postchatform.css("max-height",available_space+"px");if(surveyframe){if(restartchatcontainer.hasClass("hipmob_hide")){surveyframe.css("height",available_space)}else{surveyframe.css("height",available_space-restartchatcontainer.outerHeight()-get_margin_height(restartchatcontainer))}}if(refocus){if(textinput.is(":visible"))textinput.focus();else if(prechatinput_name.is(":visible")){prechatinput_name.focus()}}})}else{if(use_top){prechatform.addClass("hipmob_closed");postchatform.addClass("hipmob_closed");awayform.addClass("hipmob_closed")}if(host){default_tab_width=host.outerWidth()-get_border_width(host)-get_border_height(host)-get_padding_width(host)-get_padding_height(host);default_height=host.height()-get_padding_height(host)-get_margin_height(host);var css={width:default_tab_width+"px"};tab.css(css);if(resize){chatlog.css("min-height",default_height-titlebar.innerHeight()-inputcontainer.innerHeight()-get_margin_height(chatform,host)-get_padding_height(host))}}else{var css={height:default_tab_height+"px"};if(use_top){css["top"]="0px"}else{css["bottom"]="0px"}if(resize){if(use_left){default_left=default_tab_offset}else{default_left=w-default_tab_width-default_tab_offset;if(default_left<0)default_left=0;if(default_left+default_tab_width>w)default_tab_width=w;if(default_tab_width<min_default_tab_width)default_tab_width=min_default_tab_width}if(use_center){css["margin-left"]="-"+default_tab_width/2+"px";css["left"]="50%"}else{css["left"]=default_left+"px"}css["width"]=default_tab_width+"px"}if(use_top){chatform.css({"margin-top":-default_tab_height-default_height})}chatlog.removeData("max-height");tab.animate(css,250,function(){})}}};var resize_window=function(){resize_chat(true)};var resize_task=null;var queue_resize_window=function(){if(resize_task)clearTimeout(resize_task);resize_task=setTimeout(function(){resize_task=null;resize_window()},200)};var toggle_chat=function(){if(is_open){if(textinput.is(":focus"))textinput.blur();if(prechatform.find("input").is(":focus"))prechatform.find("input").blur()}is_open=!is_open;q.cookie(open_cookie_name+id_app+"_"+document.domain,q.stringifyJSON(is_open));if(is_open){if(!greeting_displayed&&!away_displayed&&away_greeting){if(status==STATUS_OFFLINE)display_message("app",appname,away_greeting,false,{sender:"user"});away_greeting=false}generate_event("Chat Opened");if(windowbutton){if(use_top){if(!("theme"in session_defaults)&&"open"in control_settings){windowbutton.removeClass("hwsicon_close").addClass("hwsicon_open")}else{windowbutton.removeClass("hmicon_close hmicon_open").addClass("hmicon_open")}}else{if(!("theme"in session_defaults)&&"close"in control_settings){windowbutton.removeClass("hwsicon_open").addClass("hwsicon_close")}else{windowbutton.removeClass("hmicon_close hmicon_open").addClass("hmicon_close")}}}self.emit("show",self);if(chrome_port)send_hipmob_chrome_extension_event("show")}else{generate_event("Chat Closed");if(windowbutton){if(use_top){if(!("theme"in session_defaults)&&"close"in control_settings){windowbutton.removeClass("hwsicon_open").addClass("hwsicon_close")}else{windowbutton.removeClass("hmicon_close hmicon_open").addClass("hmicon_close")}}else{if(!("theme"in session_defaults)&&"open"in control_settings){windowbutton.removeClass("hwsicon_close").addClass("hwsicon_open")}else{windowbutton.removeClass("hmicon_close hmicon_open").addClass("hmicon_open")}}}self.emit("hide",self);if(chrome_port)send_hipmob_chrome_extension_event("hide")}resize_chat(false,true);if(is_open){waiting_count=0;q.titleAlert.stop();iconstatus.text("");if(status==STATUS_DISCONNECTED){if(!("theme"in session_defaults)&&"disconnected"in status_settings){iconstatus.removeClass("hwsicon_online hwsicon_offline "+pendingmsg_icon_class).addClass("hwsicon_disconnected")}else{iconstatus.removeClass("hmicon_clean "+pendingmsg_icon_class+" hmicon_disconnected hmicon_offline hmicon_online").addClass("hmicon_disconnected")}}else{if(recipient&&recipient in peerstatus){if(peerstatus[recipient]==STATUS_ONLINE){if(!("theme"in session_defaults)&&"online"in status_settings){iconstatus.removeClass("hwsicon_disconnected hwsicon_offline "+pendingmsg_icon_class).addClass("hwsicon_online")}else{iconstatus.removeClass("hmicon_clean "+pendingmsg_icon_class+" hmicon_disconnected hmicon_offline hmicon_online").addClass("hmicon_online")}}else if(peerstatus[recipient]==STATUS_OFFLINE){if(!("theme"in session_defaults)&&"offline"in status_settings){iconstatus.removeClass("hwsicon_disconnected hwsicon_online "+pendingmsg_icon_class).addClass("hwsicon_offline")}else{iconstatus.removeClass("hmicon_clean "+pendingmsg_icon_class+" hmicon_disconnected hmicon_offline hmicon_online").addClass("hmicon_offline")}}}else{if(status==STATUS_ONLINE){if(!("theme"in session_defaults)&&"online"in status_settings){iconstatus.removeClass("hwsicon_disconnected hwsicon_offline "+pendingmsg_icon_class).addClass("hwsicon_online")}else{iconstatus.removeClass("hmicon_clean "+pendingmsg_icon_class+" hmicon_disconnected hmicon_offline hmicon_online").addClass("hmicon_online")}}else if(status==STATUS_OFFLINE){if(!("theme"in session_defaults)&&"offline"in status_settings){iconstatus.removeClass("hwsicon_disconnected hwsicon_online "+pendingmsg_icon_class).addClass("hwsicon_offline")}else{iconstatus.removeClass("hmicon_clean "+pendingmsg_icon_class+" hmicon_disconnected hmicon_offline hmicon_online").addClass("hmicon_offline")}}}}if(prechatform.is(":visible")){initial_focus_timer=setTimeout(function(){tab.find("#hipmob_info_input_name").focus()},100)}}};var on_titlebar_click=function(){if("closable"in chat_settings&&chat_settings.closable==false)return;toggle_chat();if(is_open)service.query("opentab");if(!is_open&&"hideonclose"in chat_settings&&chat_settings.hideonclose==true){self.hide()}};var display_message=function(source,from,text,prepend,opts){var blob=q('<div class="hmmsg'+source+'"><span class="hmfrom"></span><span class="hmtxt"></span></div>');if(renderfunc){blob=renderfunc(q,source,from,text,opts)}else{if(!("theme"in session_defaults)&&"color"in chat_settings)blob.find("span").css("color",chat_settings.color)}if(!blob.data("from"))blob.find("span.hmfrom").text(from+": ");if(!blob.data("content")){var output=blob.find("span.hmtxt");if(opts&&typeof opts=="object"&&"type"in opts&&opts.type=="image"){var img=q('<img class="imsg" />');img.attr("src",opts.thumb);img.data("url",opts.url);output.html(img)}else if(opts&&typeof opts=="object"&&"type"in opts&&opts.type=="audio"){}else{linkify(text,{callback:function(text,href){if(href){output.append(q('<a href="'+href+'" title="'+href+'" target="_blank">'+text+"</a>"))}else{output.append(document.createTextNode(text))}return""}})}}update_log(blob,prepend)};var scroll_down=function(){var mh=chatlog.data("max-height");if(mh){if(is_mobile){if(chatlog.height()<mh){q("div#hipmob_log_spacer").css({height:mh-chatlog.height()+"px",display:"block"})}else{q("div#hipmob_log_spacer").css("display","none")}}else{chatlog.css("height",mh+"px")}}chatlog.animate({scrollTop:chatlog[0].scrollHeight},"fast")};var display_typing_indicator=function(from){if(!typingindicator){typingindicator=q('<div class="hmmsgtyping">'+from+" is typing...</div>");if("color"in typing_indicator_settings)typingindicator.css("color",typing_indicator_settings["color"]);if("font-style"in typing_indicator_settings)typingindicator.css("font-style",typing_indicator_settings["font-style"]);if("font-weight"in typing_indicator_settings)typingindicator.css("font-weight",typing_indicator_settings["font-weight"]);if("font-family"in typing_indicator_settings)typingindicator.css("font-family",typing_indicator_settings["font-family"]);if("font-size"in typing_indicator_settings)typingindicator.css("font-size",typing_indicator_settings["font-size"]);update_log(typingindicator)}else{typingindicator.text(from+" is typing...");typingindicator.show();scroll_down()}};var update_log=function(newmessage,prepend){if(typingindicator&&newmessage!=typingindicator)typingindicator.hide();if(prepend){chatlog.prepend(newmessage)}else{if(!typingindicator||newmessage==typingindicator){chatlog.append(newmessage)}else{newmessage.insertBefore(typingindicator)}}if(disable_autoscroll)return;scroll_down()};var start_firefly=function(token,message){fireflyAPI.set("message",message);fireflyAPI.startAPI(token,function(url){var props={available:true};if(url)props["detail"]=url;service.update_screenshare(props)})};var on_binary_message=function(hipmob,from,data,props){self.emit("binarymessagereceived",self,from,data,props)};var on_json_message=function(hipmob,from,data,props){if("sender"in props&&props["sender"]==service.app()){if(data instanceof Object&&"request"in data&&"token"in data&&data.request=="usefirefly"){if(typeof fireflyAPI=="undefined"){window.fireflyAPI={};fireflyAPI.token="50f7aaa8443107f36b000001";var script=document.createElement("script");script.type="text/javascript";script.src="https://firefly-071591.s3.amazonaws.com/scripts/loaders/loader.js";script.async=true;script.onload=script.onreadystatechange=function(){if(typeof fireflyAPI=="undefined"){service.update_screenshare({available:false});return}setTimeout(function(){start_firefly(data.token,data.message)},2500)};var firstScript=document.getElementsByTagName("script")[0];firstScript.parentNode.insertBefore(script,firstScript)}else{start_firefly(data.token,data.message)}}else{if(data instanceof Object&&"action"in data&&"event"in data&&"payload"in data&&data.action=="emit"){self.emit("custom:"+data.event,data.payload)}else if(data instanceof Object&&"action"in data&&data.action=="set"&&"name"in data&&"value"in data){if(data.name=="title"){titletext.text(data.value)
}}else if(data instanceof Object&&"action"in data&&"channel"in data&&"contents"in data&&data.action=="notify"){if(data.channel=="browser"){if("browser"in notification_settings){if(notification_settings["browser"]=="never")return;if(notification_settings["browser"]=="blur"&&q.titleAlert.hasFocus)return}var frm=q("#"+data.contents.key);if(frm.length==0){q("body").append('<form method="GET" target="'+data.contents.key+'" action="'+data.contents.url+'" id="'+data.contents.key+'"></form>');frm=q("#"+data.contents.key)}var n=null,timeout=null;var clicks=function(){timeout=null;frm.submit()};if(window.webkitNotifications&&navigator.userAgent.indexOf("Chrome")>-1){var status=webkitNotifications.checkPermission();if(status===1||status===2)return;n=webkitNotifications.createNotification("https://hipmob.s3.amazonaws.com/icon.64.png",data.contents.from+" ("+from+")",data.contents.body);n.show();n.onclick=clicks;timeout=setTimeout(function(){if(timeout!=null){n.cancel();timeout=null}},5e3);n.onclose=function(){if(timeout!=null){clearTimeout(timeout);timeout=null}}}else if("Notification"in window){if(Notification.permission!=="granted")return;n=new Notification(data.contents.from+" ("+from+")",{body:data.contents.body,tag:data.contents.url,icon:"https://hipmob.s3.amazonaws.com/icon.64.png"});n.onshow=function(){timeout=setTimeout(function(){if(timeout!=null){n.close();timeout=null}},5e3)};n.onclick=clicks;n.onclose=function(){if(timeout!=null){clearTimeout(timeout);timeout=null}}}}}else if("notify"in chat_settings&&chat_settings.notify instanceof Array&&chat_settings.notify.length>0&&q.inArray("json",chat_settings.notify)!==false){self.emit("jsonmessagereceived",self,from,data,props)}}}};var focus_on_visible=function(){if(textinput.is(":visible")){textinput.focus()}else if(prechatinput_name.is(":visible")){prechatinput_name.focus()}else{setTimeout(focus_on_visible,100)}};var on_text_message=function(hipmob,from,text,props){if("require_branding"in session_defaults&&!branding.is(":visible"))branding.show();if(!(recipient&&"sender"in props&&props["sender"]==recipient||!recipient&&"sender"in props&&props["sender"]==service.app())){return}var is_greeting=false,is_away=false;if("category"in props){if(props["category"]=="greeting"){if(greeting==true)return;is_greeting=true;greeting_displayed=true}if(props["category"]=="away"){if(away_displayed)return;away_displayed=true;is_away=true;if(away_message){text=away_message;if(away_greeting)away_greeting=false}else if(away_greeting){text=away_greeting;away_greeting=false}}}generate_event("Chat Message from Operator",{operator:from});if("sender"in props)self.emit("textmessagereceived",self,from,text,props["sender"]);else self.emit("textmessagereceived",self,from,text);if(chrome_port){var cprops={from:from,text:text};if("sender"in props)cprops["sender"]=sender;send_hipmob_chrome_extension_event("textmessagereceived",cprops)}{var opts={};if("sender"in props)opts["sender"]=props.sender;else opts["sender"]=appid;if(processed_transcript){display_message("app",from,text,false,opts)}else{if(is_away)away_displayed=false;else if(is_greeting)greeting_displayed=false}}if(is_greeting&&"quietgreeting"in chat_settings){return}if("disable_web_chat_widget"in session_defaults&&"category"in props)return;if(!is_open){if(!is_away){++waiting_count;iconstatus.css("background-image","");iconstatus.removeClass("hmicon_clean "+pendingmsg_icon_class+" hmicon_disconnected hmicon_offline hmicon_online").addClass(pendingmsg_icon_class);if(waiting_count>99)iconstatus.text("99");else iconstatus.text(waiting_count)}}var force_redraw=false;if(!chatform.is(":visible")){if(is_greeting||is_away)return;show_only(chatform);force_redraw=true}if(!is_open&&"openonmessage"in chat_settings&&chat_settings.openonmessage){if(!is_away){toggle_chat();tab.show()}}else if(force_redraw){resize_chat(true,true);setTimeout(focus_on_visible,100)}if(!is_open||!q.titleAlert.hasFocus){if(is_away)return;var ntitle="("+waiting_count+") new message"+(waiting_count>1?"s":"")+" waiting.";if(waiting_count==0){ntitle="You have new messages waiting."}q.titleAlert(ntitle,{requireBlur:true,stopOnFocus:true,duration:0,stopOnMouseMove:true,interval:500})}};var on_image_click=function(){var t=q(this);var url=t.data("url");var box=jQuery('<div><div><img style="display: block; margin: auto" /></div></div>');box.find("img").attr("src",url);q.modal(box.html(),modal_options)};var on_image_message=function(hipmob,from,url,thumb,props){if("require_branding"in session_defaults&&!branding.is(":visible"))branding.show();if(!(recipient&&"sender"in props&&props["sender"]==recipient||!recipient&&"sender"in props&&props["sender"]==service.app())){return}generate_event("Chat Message from Operator",{operator:from});if("sender"in props)self.emit("imagemessagereceived",self,from,url,thumb,props["sender"]);else self.emit("imagemessagereceived",self,from,url,thumb);if(chrome_port){var cprops={from:from,url:url,thumb:thumb};if("sender"in props)cprops["sender"]=sender;send_hipmob_chrome_extension_event("imagemessagereceived",cprops)}{var opts={};if("sender"in props)opts["sender"]=props.sender;else opts["sender"]=appid;opts["type"]="image";opts["thumb"]=thumb;opts["url"]=url;if(processed_transcript){display_message("app",from,"",false,opts)}}if("disable_web_chat_widget"in session_defaults&&"category"in props)return;if(!is_open){++waiting_count;iconstatus.css("background-image","");iconstatus.removeClass("hmicon_clean "+pendingmsg_icon_class+" hmicon_disconnected hmicon_offline hmicon_online").addClass(pendingmsg_icon_class);if(waiting_count>99)iconstatus.text("99");else iconstatus.text(waiting_count)}var force_redraw=false;if(!chatform.is(":visible")){show_only(chatform);force_redraw=true}if(!is_open&&"openonmessage"in chat_settings&&chat_settings.openonmessage){toggle_chat();tab.show()}else if(force_redraw){resize_chat(true,true);setTimeout(focus_on_visible,100)}if(!is_open||!q.titleAlert.hasFocus){if(is_away)return;var ntitle="("+waiting_count+") new message"+(waiting_count>1?"s":"")+" waiting.";if(waiting_count==0){ntitle="You have new messages waiting."}q.titleAlert(ntitle,{requireBlur:true,stopOnFocus:true,duration:0,stopOnMouseMove:true,interval:500})}};var on_push_url=function(hipmob,from,url,props){var blob;if(renderfunc){var opts={};if("sender"in props)opts["sender"]=props.sender;else opts["sender"]=appid;blob=renderfunc(q,"app",from,text,opts.sender)}else{blob=q('<div class="hmmsgapp"><span class="hmfrom"></span><span class="hmtxt"></span></div>')}if(!blob.data("from"))blob.find("span.hmfrom").text(from+": ");if(!blob.data("content"))blob.find("span.hmtxt").html('<a target="_blank" href="'+url+'">'+url+"</a>");update_log(blob);if(tab.hasClass("hipmob_hide"))tab.removeClass("hipmob_hide");if(!is_open||!q.titleAlert.hasFocus){q.titleAlert("You have new message(s).",{requireBlur:true,stopOnFocus:true,duration:0,stopOnMouseMove:true,interval:500})}if(!is_open){++waiting_count;if(!iconstatus.hasClass(pendingmsg_icon_class)){iconstatus.css("background-image","");iconstatus.removeClass("hmicon_clean "+pendingmsg_icon_class+" hmicon_disconnected hmicon_offline hmicon_online").addClass(pendingmsg_icon_class)}if(waiting_count>99)iconstatus.text("99");else iconstatus.text(waiting_count)}};var on_channel_connected=function(hipmob,session_id){status=STATUS_CONNECTED;if(waiting_count==0){if(!("theme"in session_defaults)&&"offline"in status_settings){iconstatus.removeClass("hwsicon_disconnected hwsicon_online "+pendingmsg_icon_class).addClass("hwsicon_offline")}else{iconstatus.removeClass("hmicon_clean "+pendingmsg_icon_class+" hmicon_disconnected hmicon_offline hmicon_online").addClass("hmicon_offline")}}if(!queried_generate_events){queried_generate_events=true;service.query("generate_events");service.query("status");service.query("appname");if(crossdomain)service.query("infoform");service.query("transcript")}sid=session_id;if(savesessionfunc)savesessionfunc(self,id_app,sid);self.emit("ready",self);if(chrome_port)send_hipmob_chrome_extension_event("ready")};var on_channel_disconnected=function(hipmob,permanent,done){status=STATUS_DISCONNECTED;if(waiting_count==0){if(!("theme"in session_defaults)&&"disconnected"in status_settings){iconstatus.removeClass("hwsicon_online hwsicon_offline "+pendingmsg_icon_class).addClass("hwsicon_disconnected")}else{iconstatus.removeClass("hmicon_clean "+pendingmsg_icon_class+" hmicon_disconnected hmicon_offline hmicon_online").addClass("hmicon_disconnected")}}q.titleAlert.stop();if(permanent){q.cookie(info_cookie_name,null);q.cookie(crossdomain_info_cookie_name,null);sid=false}if(done){if("enable_survey"in session_defaults&&"survey_formkey"in session_defaults){postchatform.find("iframe").empty().remove();postchatform.prepend('<iframe id="hipmob_survey" src="'+session_defaults.survey_formkey+'" width="100%" frameborder="0" marginheight="0" marginwidth="0">Loading...</iframe>');surveyframe=postchatform.find("iframe");show_only(postchatform);resize_chat(false,true)}if(savesessionfunc)savesessionfunc(self,id_app,"")}};var on_operator_online=function(hipmob){status=STATUS_ONLINE;if(recipient==false&&waiting_count==0){if(!("theme"in session_defaults)&&"online"in status_settings){iconstatus.removeClass("hwsicon_disconnected hwsicon_offline "+pendingmsg_icon_class).addClass("hwsicon_online")}else{iconstatus.removeClass("hmicon_clean "+pendingmsg_icon_class+" hmicon_disconnected hmicon_offline hmicon_online").addClass("hmicon_online")}}if(away_title)titletext.text(chat_title);if("ifavailable"in chat_settings&&chat_settings.ifavailable)self.show();if(awayform.is(":visible"))show_only(chatform);self.emit("operatoronline",self,true)};var on_operator_offline=function(hipmob){status=STATUS_OFFLINE;if(recipient==false&&waiting_count==0){if(!("theme"in session_defaults)&&"offline"in status_settings){iconstatus.removeClass("hwsicon_disconnected hwsicon_online "+pendingmsg_icon_class).addClass("hwsicon_offline")}else{iconstatus.removeClass("hmicon_clean "+pendingmsg_icon_class+" hmicon_disconnected hmicon_offline hmicon_online").addClass("hmicon_offline")}}if(!initiated){if(away_title)titletext.text(away_title);if("ifavailable"in chat_settings&&chat_settings.ifavailable)self.hide();if(chatform.is(":visible")){}}self.emit("operatoronline",self,false)};var on_peer_visible=function(hipmob,peer){peerstatus[peer]=STATUS_ONLINE;if(recipient&&peer==recipient){if(!("theme"in session_defaults)&&"online"in status_settings){iconstatus.removeClass("hwsicon_disconnected hwsicon_offline "+pendingmsg_icon_class).addClass("hwsicon_online")}else{iconstatus.removeClass("hmicon_clean "+pendingmsg_icon_class+" hmicon_disconnected hmicon_offline hmicon_online").addClass("hmicon_online")}}};var on_peer_invisible=function(hipmob,peer){peerstatus[peer]=STATUS_OFFLINE;if(recipient&&peer==recipient){if(!("theme"in session_defaults)&&"offline"in status_settings){iconstatus.removeClass("hwsicon_disconnected hwsicon_online "+pendingmsg_icon_class).addClass("hwsicon_offline")}else{iconstatus.removeClass("hmicon_clean "+pendingmsg_icon_class+" hmicon_disconnected hmicon_offline hmicon_online").addClass("hmicon_offline")}}};var on_operator_typing=function(hipmob,oper){if("enable_typing_notices"in session_defaults){display_typing_indicator(oper)}};var on_operator_accepted=function(hipmob,oper){operator=oper;if(!initiated){initiated=true;generate_event("Chat Initiated by Operator",{operator:oper});self.emit("startconversation",self,true);if(chrome_port)send_hipmob_chrome_extension_event("startconversation",{initiated:true})}generate_event("Chat Accepted by Operator",{operator:oper});self.emit("operatoraccepted",self,oper);if(chrome_port)send_hipmob_chrome_extension_event("operatoraccepted",{operator:oper})};var on_messages_available=function(hipmob,hipmob,count){self.emit("messagesavailable",self,count);if(chrome_port)send_hipmob_chrome_extension_event("messagesavailable",{count:count})};var on_query_response=function(hipmob,category,count,values){if(category=="transcript"&&count==0)processed_transcript=true;if(count<=0||!values)return;if(values instanceof Array&&values.length>0){if(category=="generate_events"){var i,l=values.length;for(i=0;i<l;i++){if(values[i]=="mixpanel")generate_events_mixpanel=true;else if(values[i]=="ga")generate_events_ga=true}}else if(category=="infoform"){if(values[0]){show_only(chatform,true);q.cookie(crossdomain_info_cookie_name,(new Date).getTime())}}else if(category=="appname"){appname=values[0];if(greeting!==false&&greeting!==true){display_message("app",appname,greeting,false,{sender:appid});greeting=true;greeting_displayed=true}}else if(category=="status"){initiated=values[0];if(initiated){if(awayform.is(":visible")){show_only(chatform)}}}else if(category=="transcript"){if(!processed_transcript){processed_transcript=true;if(count>0){disable_autoscroll=true;var i,l=values.length-1,msg;for(i=l;i>=0;i--){msg=values[i];if(i==0)disable_autoscroll=false;if(msg.operator){if("category"in msg){if(msg.category=="away"){if(away_displayed)continue;away_displayed=true}else if(msg.category=="greeting"){if(greeting_displayed)continue;greeting_displayed=true}}if("as"in msg&&msg.as=="image"){display_message("app",msg.from,"",true,{sender:msg.operator,type:"image",thumb:msg.thumb,url:msg.url})}else if("as"in msg&&msg.as=="audio"){}else{display_message("app",msg.from,msg.body,true,{sender:msg.operator})}}else{if("as"in msg&&msg.as=="image"){display_message("me",msg.from,"",true,{sender:"user",type:"image",thumb:msg.thumb,url:msg.url})}else if("as"in msg&&msg.as=="audio"){}else{display_message("me",user_label,msg.body,true,{sender:"user"})}}}if(post_process_transcript){post_process_transcript();post_process_transcript=false}}}}else if(category=="emailtranscript"){}else if(category=="echo"){update_log_with_sent_message(values[0],false)}else if(category=="proactive"){if(values[0]=="hide"){self.hide()}else if(values[0]=="show"){self.show()}else if(values[0]=="expand"){self.open()}else if(values[0]=="minimize"){self.close()}}}};var apply_input_style_settings=function(){if("font-weight"in input_settings)textinput.css("font-weight",input_settings["font-weight"]);if("font-style"in input_settings)textinput.css("font-style",input_settings["font-style"]);if("font-family"in input_settings)textinput.css("font-family",input_settings["font-family"]);if("font-size"in input_settings)textinput.css("font-size",input_settings["font-size"]);if("height"in input_settings){var hei=get_bounds_value(input_settings.height);if(hei){textinput.css("height",hei)}}if("width"in input_settings){var wid=get_bounds_value(input_settings.width,true);if(wid){textinput.css("width",wid)}}};var apply_chat_style_settings=function(){tab.addClass("def_hm_style");if("font-weight"in chat_settings)tab.css("font-weight",chat_settings["font-weight"]);if("font-style"in chat_settings)tab.css("font-style",chat_settings["font-style"]);if("font-family"in chat_settings)tab.css("font-family",chat_settings["font-family"]);if("font-size"in chat_settings)tab.css("font-size",chat_settings["font-size"]);if("color"in chat_settings){tab.css("color",chat_settings["color"])}if("background-color"in chat_settings)tab.css("background-color",chat_settings["background-color"]);if("background-image"in chat_settings)tab.css("background-image","url("+chat_settings["background-image"]+")");if("background-repeat"in chat_settings)tab.css("background-repeat",chat_settings["background-repeat"]);if("background-position"in chat_settings)tab.css("background-position",chat_settings["background-position"]);if("border-color"in chat_settings)tab.css("border-color",chat_settings["border-color"]);if("border-style"in chat_settings)tab.css("border-style",chat_settings["border-style"]);if("border-width"in chat_settings){var bw=get_bounds_value(chat_settings["border-width"]);if(bw!==false){default_border_width=bw;if(use_top){tab.css({"border-left-width":bw,"border-right-width":bw,"border-bottom-width":bw})}else{tab.css({"border-left-width":bw,"border-right-width":bw,"border-top-width":bw})}}}};var apply_tab_style_settings=function(){if("background-color"in tab_settings)titlebar.css("background-color",tab_settings["background-color"]);if("background-image"in tab_settings)titlebar.css("background-image","url("+tab_settings["background-image"]+")");if("background-repeat"in tab_settings)titlebar.css("background-repeat",tab_settings["background-repeat"]);if("background-position"in tab_settings)titlebar.css("background-position",tab_settings["background-position"]);if("color"in tab_settings)titlebar.css("color",tab_settings["color"]);if("font-weight"in tab_settings)titlebar.css("font-weight",tab_settings["font-weight"]);if("font-style"in tab_settings)titlebar.css("font-style",tab_settings["font-style"]);if("font-family"in tab_settings)titlebar.css("font-family",tab_settings["font-family"]);if("font-size"in tab_settings)titlebar.css("font-size",tab_settings["font-size"]);if("border-width"in tab_settings){var bw=get_bounds_value(tab_settings["border-width"]);if(bw!==false){if(use_top){titlebar.css({"border-left-width":bw,"border-right-width":bw,"border-bottom-width":bw})}else{titlebar.css({"border-left-width":bw,"border-right-width":bw,"border-top-width":bw})}}}titlebar.css({height:default_tab_height+"px","line-height":default_tab_height+"px"})};var addHWSStyle=function(){var css="";if("open"in control_settings&&urlRegex.test(control_settings.open)){css=css+".hwsicon_open{background-image: url("+control_settings.open+");} "}if("close"in control_settings&&urlRegex.test(control_settings.close)){css=css+".hwsicon_close{background-image: url("+control_settings.close+");} "}if("popout"in control_settings&&urlRegex.test(control_settings.popout)){css=css+".hwsicon_popout{background-image: url("+control_settings.popout+");} "}if("disconnected"in status_settings&&urlRegex.test(status_settings.disconnected)){css=css+".hwsicon_disconnected{background-image: url("+status_settings.disconnected+");} "}if("online"in status_settings&&urlRegex.test(status_settings.online)){css=css+".hwsicon_online{background-image: url("+status_settings.online+");} "}if("offline"in status_settings&&urlRegex.test(status_settings.offline)){css=css+".hwsicon_offline{background-image: url("+status_settings.offline+");} "}if(icon_settings&&urlRegex.test(icon_settings)){css=css+"div.hipmob_custom_icon_block{display:inline}"}var head=document.getElementsByTagName("head")[0],style=document.createElement("style");style.type="text/css";style.id="hws";if(style.styleSheet){style.styleSheet.cssText=css}else{style.appendChild(document.createTextNode(css))}head.appendChild(style)};var prechat_blur_timer=null,prechat_shrink_height=null;var ensure_prechatform_is_visible=function(){if(prechat_blur_timer!=null){clearTimeout(prechat_blur_timer);prechat_blur_timer=null}if(prechat_shrink_height)return;if(prechatform_message.height()<=20)return;prechat_shrink_height=prechatform_message.height();prechatform_message.css("overflow","hidden");prechatform_message.animate({height:20},300)};var reverse_prechatform_is_visible=function(){if(!prechat_shrink_height)return;prechat_blur_timer=setTimeout(function(){prechatform_message.animate({height:prechat_shrink_height},300,function(){prechatform_message.css("overflow","")});prechat_shrink_height=null},300)};var watch_host_height=function(last_height){var new_height=host.height()-get_padding_height(host)-get_margin_height(host);if(new_height!=last_height){resize_chat(true,true);setTimeout(function(){watch_host_height(new_height)},100)}else{setTimeout(function(){watch_host_height(new_height)},1e3)}};var on_ready=function(hipmob,defaults){var use_chatform=true,update_away_message=away_message;var done=function(){if(update_away_message){awayform.empty();linkify(update_away_message,{callback:function(text,href){if(href){awayform.append(q('<a href="'+href+'" title="'+href+'" target="_blank">'+text+"</a>"))}else{awayform.append(document.createTextNode(text))}return""}})}if(use_chatform){show_only(chatform,true)}if(!("closable"in chat_settings)||chat_settings.closable==true){windowbutton.show()}if("hide"in chat_settings&&chat_settings.hide||"ifavailable"in chat_settings&&chat_settings.ifavailable){resize_on_show=true}else if("disable_web_chat_widget"in session_defaults){resize_on_show=true}else{tab.removeClass("hipmob_hide")}if(host||chat_settings.fullscreen){is_open=false;toggle_chat();if(host){setTimeout(function(){watch_host_height(default_height)},100)}}else{var should_open=q.cookie(open_cookie_name+id_app+"_"+document.domain);if(should_open){var to_open=q.parseJSON(should_open);if(to_open&&!is_open)toggle_chat()}else{if("open"in chat_settings&&chat_settings.open){if(!("disable_web_chat_widget"in session_defaults)){toggle_chat()}}}}if(!host){if(prechatform.is(":visible")){var available_space=default_height-titlebar.outerHeight()-get_margin_height(titlebar);if(!branding.hasClass("hipmob_hide")){if(branding_height==-1){branding_height=branding.outerHeight()+get_margin_height(branding)}available_space-=branding_height}var form_height=prechatform.outerHeight();if(available_space<form_height){default_height=default_height+form_height-available_space;if(branding_height!=-1)default_height=default_height+branding_height;if(is_open)tab.css("height",default_height+"px")}}}};if(defaults){session_defaults=defaults;if(!update_away_message&&"away"in defaults.messages)update_away_message=defaults.messages.away;if(!("disable_info_form"in chat_settings)&&("enable_info_form"in defaults||"enable_info_form"in chat_settings)){if("enable_info_form_phone"in session_defaults){prechatform.find("#hipmob_info_phone").removeClass("hipmob_hide");if(typeof session_defaults["enable_info_form_phone"]==="string")phone_re=new RegExp(session_defaults["enable_info_form_phone"])}if("disable_info_form"in defaults){if(console&&"log"in console)console.log("Pre-chat forms are not available for this account.")}else if(!("disable_info_form"in chat_settings)){var bits=q.cookie(info_cookie_name);if(!bits&&crossdomain)bits=q.cookie(crossdomain_info_cookie_name);if(!bits){if("greeting"in defaults.messages)prechatform_message.text(defaults.messages.greeting);if(!prechat_form_shrink_setup){prechat_form_shrink_setup=true;if(is_mobile&&chat_settings.fullscreen){prechatform.find("input,textarea").on("focus",ensure_prechatform_is_visible);prechatform.find("input,textarea").on("blur",reverse_prechatform_is_visible)}}show_only(prechatform,true);use_chatform=false}else{show_only(chatform,true)}}}if("require_branding"in defaults)branding.removeClass("hipmob_hide");else if("hide_branding"in defaults)branding.addClass("hipmob_hide");if("permit_popout"in defaults&&"show_popout_button"in chat_settings)popoutbutton.parent().removeClass("hipmob_hide");if("premium"in defaults&&"theme"in defaults){tab.addClass("hipmobtheme");if(defaults["theme"]!="custom"){q("head").append('<link rel="stylesheet" href="'+defaults["theme"]+'" type="text/css" />')}if(use_top){windowbutton.removeClass("hmicon_clean").addClass("hmicon_close")}else{windowbutton.removeClass("hmicon_clean").addClass("hmicon_open")}iconstatus.removeClass("hmicon_clean").addClass("hmicon_disconnected")}else{var cstyle=q("style#hws");if(cstyle.length==0){addHWSStyle()}apply_chat_style_settings();apply_tab_style_settings();apply_input_style_settings();if(icon_settings){tab.find("#hipmob_custom_icon").attr("src",icon_settings)}if("popout"in control_settings){popoutbutton.addClass("hwsicon_popout")}if(use_top){if("close"in control_settings){windowbutton.addClass("hwsicon_close")}else{windowbutton.removeClass("hmicon_clean").addClass("hmicon_close")}}else{if("open"in control_settings){windowbutton.addClass("hwsicon_open")}else{windowbutton.removeClass("hmicon_clean").addClass("hmicon_open")}}if("disconnected"in status_settings){iconstatus.addClass("hwsicon_disconnected")}else{iconstatus.removeClass("hmicon_clean").addClass("hmicon_disconnected")}}}done()};var update_log_with_sent_message=function(text,from_this_window){if(!initiated){initiated=true;if(from_this_window)generate_event("Chat Initiated by Visitor");self.emit("startconversation",self,false);if(chrome_port)send_hipmob_chrome_extension_event("startconversation",{initiated:false})}generate_event("Chat Message from Visitor");self.emit("textmessagesent",self,text);if(chrome_port)send_hipmob_chrome_extension_event("textmessagesent",{text:text});var blob;if(renderfunc){blob=renderfunc(q,"me",user_label,text,"user")}else{blob=q('<div class="hmmsgme"><span class="hmfrom"></span><span class="hmtxt"></span></div>')}if(!("theme"in session_defaults)&&"color"in chat_settings)blob.find("span").css("color",chat_settings.color);if(!blob.data("from"))blob.find("span.hmfrom").text(user_label+": ");if(!blob.data("content")){var output=blob.find("span.hmtxt");linkify(text,{callback:function(text,href){if(href){output.append(q('<a href="'+href+'" title="'+href+'" target="_blank">'+text+"</a>"))}else{output.append(document.createTextNode(text))}return""}})}update_log(blob);return false};var perform_send=function(event,messagetext){var text=messagetext?messagetext:q.trim(textinput.val());if(typeahead_timer){clearTimeout(typeahead_timer);typeahead_timer=false}textinput.val("");last_text="";if(event){event.preventDefault();event.stopPropagation()}if(text=="")return;if(recipient)service.send_text_message(text,recipient);else service.send_text_message(text);return update_log_with_sent_message(text,true)};var process_keypress=function(keycode,event){if(keycode=="13"){return perform_send(event)}else{var text=q.trim(textinput.val());if("typeahead"in session_defaults){if(typeahead_timer){clearTimeout(typeahead_timer)}typeahead_timer=setTimeout(function(){var txt=q.trim(textinput.val());if(txt!=last_text&&txt!=""){}last_text=txt},50)}}};var on_keypress=function(event){var keycode=event.keyCode?event.keyCode:event.which;process_keypress(keycode,event)};var on_window_scroll=function(){var win=q(window),w=win.width(),h=win.height();tab.css("top",h-default_tab_height+"px")};var unload=function(){if(unloaded)return;unloaded=true};var cancelZoom=function(){var d=document,viewport,content,maxScale=",maximum-scale=",maxScaleRegex=/,*maximum\-scale\=\d*\.*\d*/;if(!this.addEventListener||!d.querySelector){return}viewport=d.querySelector('meta[name="viewport"]');if(!viewport)return;content=viewport.content;var changeViewport=function(event){viewport.content=content+(event.type=="blur"?content.match(maxScaleRegex,"")?"":maxScale+10:maxScale+1)};this.addEventListener("focus",changeViewport,true);this.addEventListener("blur",changeViewport,false)};var receive_hipmob_chrome_extension_messages=function(e){if(!("name"in e.detail))return;if(e.detail.name=="open"){self.open()}else if(e.detail.name=="close"){self.close()}else if(e.detail.name=="hide"){self.hide()}else if(e.detail.name=="show"){self.show()}else if(e.detail.name=="send"&&"data"in e.detail&&"text"in e.detail.data){service.send_text_message(e.detail.data.text)}else if(e.detail.name=="clear"){chatlog.empty()}};var send_hipmob_chrome_extension_event=function(name,data){var ev=document.createEvent("CustomEvent");ev.initCustomEvent("HipmobClientEvent",true,true,{name:name,data:data});document.dispatchEvent(ev)};var cancel_initial_focus=function(event){if(initial_focus_timer===true)return;if(initial_focus_timer!==false)clearTimeout(initial_focus_timer);initial_focus_timer=true};var apply_domain_info=function(domain_info){if("name"in domain_info)service.update_name(domain_info["name"]);if("email"in domain_info)service.update_email(domain_info["email"]);if("phone"in domain_info)service.update_phone(domain_info["phone"]);if("context"in domain_info)service.update_context(domain_info["context"],{infoform:true});show_only(chatform)};var on_prechat_form_submit=function(){var val,name=tab.find("#hipmob_info_input_name"),email=tab.find("#hipmob_info_input_email"),phone=tab.find("#hipmob_info_input_phone"),question=tab.find("#hipmob_info_input_question");var domain_info={};if(name.is(":visible")){val=q.trim(name.val());if(val==""||val==autofills.info.name){name.focus();name.addClass("hipmob_input_required");return false}else{name.removeClass("hipmob_input_required");domain_info["name"]=val}}if(email.is(":visible")){val=q.trim(email.val());if(val==""||val==autofills.info.email){email.focus();email.addClass("hipmob_input_required");return false}else if(!email_re.test(val)){email.val("");email.focus();email.addClass("hipmob_input_required");return false}else{email.removeClass("hipmob_input_required");domain_info["email"]=val}}if(phone.is(":visible")){val=q.trim(phone.val());if(val==""||val==autofills.info.phone){phone.focus();phone.addClass("hipmob_input_required");return false}else if(!phone_re.test(val)){phone.val("");phone.focus();phone.addClass("hipmob_input_required");return false}else{phone.removeClass("hipmob_input_required");domain_info["phone"]=val}}if(question.is(":visible")){val=q.trim(question.val());if(val==""||val==autofills.info.question){question.focus();question.addClass("hipmob_input_required");return false}else{question.removeClass("hipmob_input_required");if("context"in domain_info)domain_info["context"]=domain_info["context"]+" "+val;else domain_info["context"]=val;perform_send(null,val)}}apply_domain_info(domain_info);q.cookie(info_cookie_name,q.stringifyJSON(domain_info));return false};var popout_check=function(){if(!popout_window||"closed"in popout_window&&popout_window.closed){clearInterval(popout_check_timer);popout_check_timer=false;processed_transcript=false;typingindicator=false;chatlog.empty();service.query("transcript");post_process_transcript=function(){if(is_open)toggle_chat();if(tab.hasClass("hipmob_hide"))tab.removeClass("hipmob_hide");scroll_down();toggle_chat()}}else{if(!tab.hasClass("hipmob_hide"))tab.addClass("hipmob_hide")}};var on_email_transcript=function(event){event.stopPropagation();if(!user_name||!user_email){show_only(emailform);return}service.query("emailtranscript",{name:user_name,email:user_email})};var on_popout_chat=function(event){event.stopPropagation();if(!popout_window||"closed"in popout_window&&popout_window.closed){var chaturl=(page_secure?"https://":"http://")+asset_host+"/chat.html";var chatoptions={app:id_app,title:chat_title,context:"viewing the chat in a popout window."};if(user_id)chatoptions["userid"]=user_id;var options="";if(!is_mobile){options="resizable,";if("window-width"in chat_settings)options=options+"width="+chat_settings["window-width"];else options=options+"width=480";if("window-height"in chat_settings)options=options+"height="+chat_settings["window-height"];else options=options+"height=480"}if(sid)chatoptions["sid"]=sid;chatoptions["placeholder"]=input_placeholder;if("disable_info_form"in chat_settings||!prechatform.is(":visible"))chatoptions["disable_info_form"]=true;popout_window=window.open(chaturl+"?"+q.param(chatoptions),"hipmob_chat_window",options);if(popout_check_timer)clearInterval(popout_check_timer);popout_check_timer=setInterval(popout_check,1500);tab.addClass("hipmob_hide")}else if("focus"in popout_window){popout_window.focus()}};var on_restart_chat=function(){self.close();tab.addClass("hipmob_hide");service.once("ready",function(){self.open()});service.start()};var supports_input=function(thetype){if("createElement"in document){var i=document.createElement("input");i.setAttribute("type",thetype);return i.type===thetype}return false};var load_hipmob=function(){if(chat_loaded)return;chat_loaded=true;var showalert=false;if(typeof window._hmc!="object"){var hs=q("#hipmobscript");if(hs.length>0){var config=hs.data("config");if(config&&config!="")window._hmc=config}}if(typeof window._hmc!="object")return;var op;while(_hmc.length>0){op=_hmc.shift();if(op instanceof Array&&op.length>1){if(op[0]=="app"&&op.length==2&&typeof op[1]=="string"){id_app=q.trim(op[1]);if(id_app[0]=="<"&&endsWith(id_app,">"))id_app=id_app.substring(1,id_app.length-1)}else if(op[0]=="group"&&op.length==2&&typeof op[1]=="string"){group_id=q.trim(op[1])}else if(op[0]=="settings"&&op.length==2&&typeof op[1]=="object"){q.extend(chat_settings,op[1])
}else if(op[0]=="input"&&op.length==2&&typeof op[1]=="object"){q.extend(input_settings,op[1])}else if(op[0]=="tab"&&op.length==2&&typeof op[1]=="object"){q.extend(tab_settings,op[1])}else if(op[0]=="typing-indicator"&&op.length==2&&typeof op[1]=="object"){q.extend(typing_indicator_settings,op[1])}else if(op[0]=="icon"&&op.length==2&&typeof op[1]=="string"){icon_settings=op[1]}else if(op[0]=="statusicons"&&op.length==2&&typeof op[1]=="object"){q.extend(status_settings,op[1])}else if(op[0]=="controlicons"&&op.length==2&&typeof op[1]=="object"){q.extend(control_settings,op[1])}else if(op[0]=="title"&&op.length==2&&typeof op[1]=="string"){chat_title=op[1]}else if(op[0]=="title_away"&&op.length==2&&typeof op[1]=="string"){chat_settings["title_away"]=op[1]}else if(op[0]=="name"&&op.length==2&&typeof op[1]=="string"){user_name=op[1]}else if(op[0]=="email"&&op.length==2&&typeof op[1]=="string"){user_email=op[1]}else if(op[0]=="phone"&&op.length==2&&typeof op[1]=="string"){user_phone=op[1]}else if(op[0]=="context"&&(op.length==2||op.length==3)&&typeof op[1]=="string"){user_context=op[1];if(op.length==3)user_context_properties=op[2]}else if(op[0]=="uid"&&op.length==2){user_id=op[1]+""}else if(op[0]=="sid"&&op.length==2){sid=op[1]+""}else if(op[0]=="crossdomain"&&op.length==3&&typeof op[1]=="function"&&typeof op[2]=="function"){crossdomain=true;savesessionfunc=op[1];restoresessionfunc=op[2]}else if(op[0]=="to"&&op.length==2&&typeof op[1]=="string"){recipient=op[1]}else if(op[0]=="on_load"&&op.length==2&&typeof op[1]=="function"){loadfunc=op[1]}else if(op[0]=="on_row"&&op.length==2&&typeof op[1]=="function"){renderfunc=op[1]}else if(op[0]=="session_load"&&op.length==2&&typeof op[1]=="function"){loadfunc=op[1]}else if(op[0]=="notification_settings"&&op.length==2&&typeof op[1]=="object"){q.extend(notification_settings,op[1])}else if(op[0]=="pre_load"&&op.length==2&&typeof op[1]=="function"){preloadfunc=op[1]}else if(op[0]=="greeting"&&op.length==2&&typeof op[1]=="string"){chat_settings["greeting"]=op[1]}else if(op[0]=="greeting_away"&&op.length==2&&typeof op[1]=="string"){chat_settings["greeting_away"]=op[1]}else if(op[0]=="userlabel"&&op.length==2&&typeof op[1]=="string"){chat_settings["userlabel"]=op[1]}else if(op[0]=="placeholder"&&op.length==2&&typeof op[1]=="string"){chat_settings["placeholder"]=op[1]}else if(op[0]=="away"&&op.length==2&&typeof op[1]=="string"){chat_settings["away"]=op[1]}else if(op[0]=="env"&&op.length==2&&typeof op[1]=="string"){env=op[1];if(env=="chrome"&&"createEvent"in document){chrome_port=true;send_hipmob_chrome_extension_event("created");document.addEventListener("HipmobExtensionEvent",receive_hipmob_chrome_extension_messages,false,true)}}}}var win=q(window),w=win.width(),h=win.height(),doc=q("body");is_iframe==window.self===window.top;doc.append('<div id="hipmob_mobile_detector" style="height: 0px" class="hipmob_mobile_detector">&nbsp;</div>');var mobile_detect=doc.find("div#hipmob_mobile_detector");is_mobile=!is_iframe&&mobile_detect.css("display")=="none";mobile_detect.remove();if("greeting"in chat_settings)greeting=chat_settings.greeting;if("away"in chat_settings)away_message=chat_settings.away;if("userlabel"in chat_settings)user_label=chat_settings.userlabel;if("placeholder"in chat_settings)input_placeholder=chat_settings.placeholder;if("greeting_away"in chat_settings)away_greeting=chat_settings.greeting_away;if("title_away"in chat_settings)away_title=chat_settings.title_away;if("name_placeholder"in chat_settings){autofills.info.name=chat_settings.name_placeholder;autofills.offline.name=chat_settings.name_placeholder}if("email_placeholder"in chat_settings){autofills.info.email=chat_settings.email_placeholder;autofills.offline.email=chat_settings.email_placeholder}if("phone_placeholder"in chat_settings){autofills.info.phone=chat_settings.phone_placeholder;autofills.offline.phone=chat_settings.phone_placeholder}if("question_placeholder"in chat_settings){autofills.info.question=chat_settings.question_placeholder;autofills.offline.question=chat_settings.question_placeholder}if("prechat_form_button_label"in chat_settings){info_button_label=chat_settings.prechat_form_button_label}if(!id_app)return;else{info_cookie_name="_hipmob_prechat_info_"+id_app;crossdomain_info_cookie_name="_hipmob_xd_prechat_info_"+id_app}if(preloadfunc)preloadfunc(id_app,env);else if(chrome_port)send_hipmob_chrome_extension_event("preload",{app:id_app,url:document.location.href});if(user_id)service=new Hipmob(id_app,user_id);else service=new Hipmob(id_app);if(group_id)service.set_group(group_id);if(crossdomain)service.set_cross_domain(true);if(user_name){service.update_name(user_name);user_label=user_name}if(user_email)service.update_email(user_email);if(user_phone)service.update_phone(user_phone);if(user_context)service.update_context(user_context,user_context_properties);if(pending_tasks.length>0){while(pending_tasks.length>0){op=pending_tasks.shift();if(op[0]=="name"){service.update_name(op[1]);user_label=op[1]}else if(op[0]=="email"){service.update_email(op[1])}else if(op[0]=="phone"){service.update_phone(op[1])}else if(op[0]=="context"){service.update_context(op[1])}}}q("#hipmob_tab").empty().remove();var supports_email_input=supports_input("email"),supports_tel_input=supports_input("tel");tab=q('<div id="hipmob_tab" class="hipmob_tab hipmob_hide"><div id="hipmob_titlebar" class="hipmob_titlebar"><div id="hipmob_custom_icon_block" class="hipmob_custom_icon_block"><img id="hipmob_custom_icon" class="hipmob_custom_icon" /></div><div id="hipmob_status_icon_block" class="hipmob_status_icon_block"><div id="hipmob_status_icon" class="hipmob_status_icon hmicon hmicon_clean"></div></div><div id="hipmob_title" class="hipmob_title"></div><div id="hipmob_openclose_block" class="hipmob_openclose_block"><div id="hipmob_window_button" class="hipmob_window_button hmicon hmicon_clean" /></div><div id="hipmob_popout_block" class="hipmob_popout_block hipmob_hide"><div id="hipmob_popout_button" class="hipmob_popout_button hmicon hmicon_popout" /></div><div id="hipmob_email_block" class="hipmob_email_block hipmob_hide"><div id="hipmob_email_transcript_button" class="hipmob_email_transcript_button hmicon hmicon_email" /></div></div>'+'<div id="hipmob_info" class="hipmob_info hipmob_hide"><form id="hipmob_info_form">'+'<div id="hipmob_info_message">Tell us a little bit about you:</div>'+'<div id="hipmob_info_name"><input type="text" class="hipmob_input hipmob_class_input" id="hipmob_info_input_name" autocorrect="off" /></div>'+'<div id="hipmob_info_email"><input type="'+(supports_email_input?"email":"text")+'" class="hipmob_input hipmob_class_input" id="hipmob_info_input_email" autocorrect="off" autocapitalize="off" /></div>'+'<div id="hipmob_info_phone" class="hipmob_hide"><input type="'+(supports_tel_input?"tel":"text")+'" class="hipmob_input hipmob_class_input" id="hipmob_info_input_phone" autocorrect="off" /></div>'+'<div id="hipmob_info_question"><textarea class="hipmob_input hipmob_class_textarea" id="hipmob_info_input_question" autocorrect="off" /></div>'+'<div id="hipmob_info_buttons"><input type="button" id="hipmob_info_input_button" class="hipmob_class_button" value="Continue" /><div style="clear: both"></div></div>'+"</form></div>"+'<div id="hipmob_email" class="hipmob_email hipmob_hide"><form id="hipmob_email_form">'+'<div id="hipmob_email_message">Enter your name and email address to receive a transcript of this conversation by email after the conversation ends:</div>'+'<div id="hipmob_email_name"><input type="text" class="hipmob_input hipmob_class_input" id="hipmob_email_input_name" autocorrect="off" /></div>'+'<div id="hipmob_email_email"><input type="text" class="hipmob_input hipmob_class_input" id="hipmob_email_input_email" autocorrect="off" /></div>'+'<div id="hipmob_email_buttons"><input type="button" id="hipmob_email_input_button" class="hipmob_class_button" value="Email Me" /><div style="clear: both"></div></div>'+"</form></div>"+'<div id="hipmob_offline_form" class="hipmob_offline_form hipmob_hide" style="width: 100%">'+"</div>"+'<div id="hipmob_queue_form" class="hipmob_hide" style="width: 100%">'+"</div>"+'<div id="hipmob_postchat_form" class="hipmob_hide" style="width: 100%">'+'<div id="hipmob_restartchat" class="hipmob_restartchat"><input type="button" id="hipmob_restart_chat_button" class="hipmob_class_button" value="Return to Chat" /><div style="clear: both"></div></div>'+"</div>"+'<div id="hipmob_chat" class="hipmob_chat hipmob_hide"><div id="hipmob_log_spacer" class="hipmob_log_spacer"></div><div id="hipmob_log" class="hipmob_log"></div><div id="hipmob_input_container" class="hipmob_input_container"><div id="hipmob_input_block" class="hipmob_input_block"><form><table id="hipmob_input_table" class="hipmob_input_table"><tr><td><textarea id="hipmob_input" type="text" placeholder="" autocorrect="off" class="hipmob_input"></textarea></td><td><button id="hipmob_send_button" class="hipmob_send_button hipmob_hide">Send</button></td></tr></table></form></div></div></div><div id="hipmob_branding" class="hipmob_branding"></div></div>');if("position"in chat_settings){if(chat_settings.position.indexOf("#")==0){var hosts=q(chat_settings.position);if(hosts.length>0)host=q(hosts[0])}}if(host){default_tab_width=host.outerWidth()-get_border_width(host)-get_border_height(host)-get_padding_width(host)-get_padding_height(host);default_tab_offset=0;default_height=host.height()-get_padding_height(host)-get_margin_height(host);tab.css("position","")}else if(chat_settings.fullscreen){default_tab_width=w;default_tab_offset=0;default_height=h;doc.css({"padding-top":"0px","margin-top":"0px","padding-bottom":"0px","margin-bottom":"0px","padding-left":"0px","margin-left":"0px","padding-right":"0px","margin-right":"0px"});q("html").css({"padding-top":"0px","margin-top":"0px","padding-bottom":"0px","margin-bottom":"0px","padding-left":"0px","margin-left":"0px","padding-right":"0px","margin-right":"0px"})}if(!host&&"width"in chat_settings){var wid=get_bounds_value(chat_settings.width);if(wid){if(wid<min_default_tab_width)wid=min_default_tab_width;default_tab_width=wid}}if(!host&&"height"in chat_settings){var hei=get_bounds_value(chat_settings.height);if(hei){if(hei<min_default_widget_height)hei=min_default_widget_height;default_height=hei}}if(!host&&"position"in chat_settings){if(chat_settings.position=="topright"||chat_settings.position=="topleft"||chat_settings.position=="bottomleft"||chat_settings.position=="bottomright"||chat_settings.position=="topcenter"||chat_settings.position=="bottomcenter"){position=chat_settings.position;if(position.indexOf("top")===0)use_top=true;if(endsWith(position,"center"))use_center=true;if(endsWith(position,"left"))use_left=true}}if(!host&&"offset"in chat_settings){var off=get_bounds_value(chat_settings.offset);if(off){if(off<min_default_tab_offset)off=min_default_tab_offset;default_tab_offset=off}}if("height"in tab_settings){var hei=get_bounds_value(tab_settings.height);if(hei){if(hei<min_default_tab_height)hei=min_default_tab_height;default_tab_height=hei}}if(!host){if(use_left){default_left=default_tab_offset}else{default_left=w-default_tab_width-default_tab_offset;if(default_left<0)default_left=0;if(default_left+default_tab_width>w)default_tab_width=w;if(default_tab_width<min_default_tab_width)default_tab_width=min_default_tab_width}}chatform=tab.find("#hipmob_chat");postchatform=tab.find("#hipmob_postchat_form");prechatform=tab.find("#hipmob_info");emailform=tab.find("#hipmob_email");branding=tab.find("#hipmob_branding");awayform=tab.find("#hipmob_offline_form");queueform=tab.find("#hipmob_queue_form");chatlog=tab.find("#hipmob_log");inputcontainer=tab.find("#hipmob_input_container");restartchatcontainer=postchatform.find("div#hipmob_restartchat");restartchatbutton=restartchatcontainer.find("#hipmob_restart_chat_button");textinput=tab.find("#hipmob_input");inputblock=tab.find("#hipmob_input_block");titlebar=tab.find("#hipmob_titlebar");titletext=tab.find("#hipmob_title");iconstatus=tab.find("#hipmob_status_icon");popoutbutton=tab.find("#hipmob_popout_button");emailtranscriptbutton=tab.find("#hipmob_email_transcript_button");sendbutton=tab.find("#hipmob_send_button");sendbutton.parent().on("submit",function(e){return false});sendbutton.on("click",function(e){perform_send(e);if(!is_mobile)textinput.focus()});sendbutton.on("touchend",function(e){perform_send(e)});prechatform_message=prechatform.find("#hipmob_info_message");prechatform.find("form").submit(function(){return false});prechatinput_name=prechatform.find("#hipmob_info_input_name");if(use_placeholder)prechatinput_name.attr("placeholder",autofills.info.name);else prechatinput_name.autofill({value:autofills.info.name});prechatinput_name.on("focus",cancel_initial_focus);prechatinput_email=prechatform.find("#hipmob_info_input_email");if(use_placeholder)prechatinput_email.attr("placeholder",autofills.info.email);else prechatinput_email.autofill({value:autofills.info.email});prechatinput_email.on("focus",cancel_initial_focus);var felement=prechatform.find("#hipmob_info_input_phone");if(use_placeholder)felement.attr("placeholder",autofills.info.phone);else felement.autofill({value:autofills.info.phone});felement.on("focus",cancel_initial_focus);prechatinput_question=prechatform.find("#hipmob_info_input_question");if(use_placeholder)prechatinput_question.attr("placeholder",autofills.info.question);else prechatinput_question.autofill({value:autofills.info.question});prechatinput_question.on("focus",cancel_initial_focus);felement=prechatform.find("#hipmob_info_input_button");felement.on("click",on_prechat_form_submit);if(info_button_label)felement.attr("value",info_button_label);var felement=emailform.find("#hipmob_email_input_name");if(use_placeholder)felement.attr("placeholder",autofills.email.name);else felement.autofill({value:autofills.email.name});felement.on("focus",cancel_initial_focus);felement=emailform.find("#hipmob_email_input_email");if(use_placeholder)felement.attr("placeholder",autofills.email.email);else felement.autofill({value:autofills.email.email});felement.on("focus",cancel_initial_focus);var css={height:default_tab_height+"px",width:default_tab_width+"px","min-height":default_tab_height+"px"};if(!host){if(use_top){css["top"]="0px";css["border-top-width"]="0px"}else{css["bottom"]="0px";css["border-bottom-width"]="0px"}if(use_center){css["margin-left"]="-"+default_tab_width/2+"px";css["left"]="50%"}else{css["left"]=default_left+"px"}}else{if("open"in chat_settings&&chat_settings.open){css["height"]=default_height+"px"}}tab.css(css);var pt=Math.round((default_tab_height-24)/2);tab.find("#hipmob_status_icon_block").css({height:default_tab_height-pt+"px","line-height":default_tab_height-pt+"px"});tab.find("#hipmob_status_icon_block").css("margin-top",pt);tab.find("#hipmob_openclose_block").css("margin-top",pt);tab.find("#hipmob_popout_block").css("margin-top",pt);tab.find("#hipmob_email_block").css("margin-top",pt);if("restartlabel"in chat_settings)restartchatbutton.attr("value",chat_settings["restartlabel"]);if("hiderestart"in chat_settings&&chat_settings.hiderestart)restartchatcontainer.addClass("hipmob_hide");if("hidebranding"in chat_settings)branding.addClass("hipmob_hide");win.on("resize",queue_resize_window);win.on("orientationchange",resize_window);win.on("unload",unload);win.on("beforeunload",unload);titlebar.on("click",on_titlebar_click);restartchatbutton.on("click",on_restart_chat);if(chat_settings.fullscreen)popoutbutton.hide();else popoutbutton.on("click",on_popout_chat);emailtranscriptbutton.on("click",on_email_transcript);textinput.attr("placeholder",input_placeholder);textinput.on("keypress",on_keypress);if("placeholder"in input_settings){if(typeof input_settings.placeholder=="string")textinput.prop("placeholder",input_settings.placeholder);else if(!input_settings.placeholder)textinput.prop("placeholder","")}if(use_top){chatform.data("mt",default_tab_height-default_height);chatform.css("margin-top",chatform.data("mt"));var log_height=tab.height()-titlebar.outerHeight()-get_margin_height(titlebar)-inputcontainer.outerHeight()-get_margin_height(chatlog,inputcontainer);chatlog.css("max-height",log_height+"px");chatlog.data("max-height",log_height)}titletext.text(chat_title);if("showsendbutton"in chat_settings&&chat_settings.showsendbutton){sendbutton.removeClass("hipmob_hide")}if(use_top){pendingmsg_icon_class="hmicon_redblank_top"}if(host){host.empty().append(tab)}else{doc.append(tab)}if(is_mobile){var vheight=false,ht=false,ml=0,val2,lastY=0;val2=get_bounds_value(doc.css("padding-left"));if(val2!==0)ml=val2;val2=get_bounds_value(doc.css("margin-left"));if(val2!==0)ml+=val2;var handle_focus=function(event){has_focus=true};var handle_blur=function(e){has_focus=false};textinput.on("focus",handle_focus).on("blur",handle_blur).cancelZoom();prechatform.find("input").on("focus",handle_focus).on("blur",handle_blur).cancelZoom();doc.on("touchmove",function(ev){if(!has_focus)return;var parents=q(ev.target).closest("#hipmob_chat");if(parents.length==0){ev.preventDefault()}else{if("originalEvent"in ev){var touch=null;if("touches"in ev.originalEvent)touch=ev.originalEvent.touches[0];else if("changedTouches"in ev.originalEvent)touch=ev.originalEvent.changedTouches[0];if(touch){var cy=touch.clientY;if(cy>lastY&&chatlog.scrollTop()==0){ev.preventDefault()}lastY=cy}}}})}else{q("#hipmob_log_spacer").remove()}chatlog.on("click","img.imsg",on_image_click);if(use_top)iconstatus.css("padding-top","6px");service.on("ready",on_ready);service.on("connected",on_channel_connected);service.on("disconnected",on_channel_disconnected);service.on("operatoronline",on_operator_online);service.on("operatoroffline",on_operator_offline);service.on("visible",on_peer_visible);service.on("invisible",on_peer_invisible);service.on("query",on_query_response);service.on("accepted",on_operator_accepted);service.on("messagesavailable",on_messages_available);service.on("text",on_text_message);service.on("url",on_push_url);service.on("json",on_json_message);service.on("binary",on_binary_message);service.on("image",on_image_message);service.on("typing",on_operator_typing);windowbutton=q("#hipmob_window_button");modal_options["zIndex"]=parseInt(q("div#hipmob_tab").css("z-index"))+1;if(!sid&&restoresessionfunc)sid=restoresessionfunc(self,id_app);if(sid&&sid!="")service.start(sid);else service.start();if(loadfunc)loadfunc(self);else if(chrome_port)send_hipmob_chrome_extension_event("load");var toggle_buttons=q('[data-hipmob-toggle="true"]');if(toggle_buttons.length>0){toggle_buttons.on("click",function(){self.show();self.open()})}};if(typeof Hipmob=="undefined"){var hjqs=document.createElement("script");hjqs.type="text/javascript";hjqs.async=true;hjqs.src=(page_secure?"https://":"http://")+asset_host+"/hipmob.min.js";hjqs.onload=hjqs.onreadystatechange=function(){if(typeof Hipmob=="undefined")return;startup()};var blk=document.getElementsByTagName("script")[0];blk.parentNode.insertBefore(hjqs,blk)}else{startup()}self["get_version"]=function(){return"0.4.0"};self["check_for_messages"]=function(appid,userid){if(!service)return false;service.check_pending_messages(appid,userid);return true};self["set_title"]=function(title){chat_title=title;tab.find("#hipmob_title").text(chat_title)};self["get_app_name"]=function(){return appname};self["set_name"]=function(name){if(service){var ni=q("#hipmob_info_input_name");if(q.trim(ni.val())=="")ni.val(name);service.update_name(name);user_label=name}else{pending_tasks.push(["name",name])}user_name=name};self["set_email"]=function(email){if(service){var ne=q("#hipmob_info_input_email");if(q.trim(ne.val())=="")ne.val(email);service.update_email(email)}else{pending_tasks.push(["email",email])}user_email=email};self["set_phone"]=function(phone){if(service){var ne=q("#hipmob_info_input_phone");if(q.trim(ne.val())=="")ne.val(phone);service.update_phone(phone)}else{pending_tasks.push(["phone",phone])}user_phone=phone};self["set_context"]=function(context,properties){if(service){var nc=q("#hipmob_info_input_question");if(q.trim(nc.val())=="")nc.val(context);service.update_context(context,properties)}else{pending_tasks.push(["context",context,properties])}user_context=context};self["open"]=function(){if(tab.hasClass("hipmob_hide"))tab.removeClass("hipmob_hide");if(!is_open)toggle_chat()};self["close"]=function(){if(is_open)toggle_chat()};self["hide"]=function(){tab.addClass("hipmob_hide");self.emit("invisible",self);if(chrome_port)send_hipmob_chrome_extension_event("invisible")};self["show"]=function(){if(tab.hasClass("hipmob_hide"))tab.removeClass("hipmob_hide");if(resize_on_show){resize_on_show=false;resize_chat(false,true)}self.emit("visible",self);if(chrome_port)send_hipmob_chrome_extension_event("visible")};self["resize"]=function(){if(host){resize_chat(true)}};self["send_now"]=function(){process_keypress(13)};self["get_send_button"]=function(){return sendbutton};self["update"]=function(){};var setup_modal=function($){var d=[],doc=$(document),ua=navigator.userAgent.toLowerCase(),wndw=$(window),w=[];var browser={ieQuirks:null,msie:/msie/.test(ua)&&!/opera/.test(ua),opera:/opera/.test(ua)};browser.ie6=browser.msie&&/msie 6./.test(ua)&&typeof window["XMLHttpRequest"]!=="object";browser.ie7=browser.msie&&/msie 7.0/.test(ua);$.modal=function(data,options){return $.modal.impl.init(data,options)};$.modal.close=function(){$.modal.impl.close()};$.modal.focus=function(pos){$.modal.impl.focus(pos)};$.modal.setContainerDimensions=function(){$.modal.impl.setContainerDimensions()};$.modal.setPosition=function(){$.modal.impl.setPosition()};$.modal.update=function(height,width){$.modal.impl.update(height,width)};$.fn.modal=function(options){return $.modal.impl.init(this,options)};$.modal.defaults={appendTo:"body",focus:true,opacity:50,overlayId:"hipmob-modal-overlay",overlayCss:{},containerId:"hipmob-modal-container",containerCss:{},dataId:"hipmob-modal-data",dataCss:{},minHeight:null,minWidth:null,maxHeight:null,maxWidth:null,autoResize:false,autoPosition:true,zIndex:1e3,close:true,closeHTML:'<a class="hmicon hmicon_modal_close" title="Close"></a>',closeClass:"hipmob-modal-close",escClose:true,overlayClose:false,fixed:true,position:null,persist:false,modal:true,onOpen:null,onShow:null,onClose:null};$.modal.impl={d:{},init:function(data,options){var s=this;if(s.d.data){return false}browser.ieQuirks=browser.msie&&!$.support.boxModel;s.o=$.extend({},$.modal.defaults,options);s.zIndex=s.o.zIndex;s.occb=false;if(typeof data==="object"){data=data instanceof $?data:$(data);s.d.placeholder=false;if(data.parent().parent().size()>0){data.before($("<span></span>").attr("id","hipmob-modal-placeholder").css({display:"none"}));s.d.placeholder=true;s.display=data.css("display");if(!s.o.persist){s.d.orig=data.clone(true)}}}else if(typeof data==="string"||typeof data==="number"){data=$("<div></div>").html(data)}else{alert("Hipmob Modal Error: Unsupported data type: "+typeof data);return s}s.create(data);data=null;s.open();if($.isFunction(s.o.onShow)){s.o.onShow.apply(s,[s.d])}return s},create:function(data){var s=this;s.getDimensions();if(s.o.modal&&browser.ie6){s.d.iframe=$('<iframe src="javascript:false;"></iframe>').css($.extend(s.o.iframeCss,{display:"none",opacity:0,position:"fixed",height:w[0],width:w[1],zIndex:s.o.zIndex,top:0,left:0})).appendTo(s.o.appendTo)}s.d.overlay=$("<div></div>").attr("id",s.o.overlayId).addClass("hipmob-modal-overlay").css($.extend(s.o.overlayCss,{display:"none",opacity:s.o.opacity/100,height:s.o.modal?d[0]:0,width:s.o.modal?d[1]:0,position:"fixed",left:0,top:0,zIndex:s.o.zIndex+1})).appendTo(s.o.appendTo);s.d.container=$("<div></div>").attr("id",s.o.containerId).addClass("hipmob-modal-container").css($.extend({position:s.o.fixed?"fixed":"absolute"},s.o.containerCss,{display:"none",zIndex:s.o.zIndex+2})).append(s.o.close&&s.o.closeHTML?$(s.o.closeHTML).addClass(s.o.closeClass):"").appendTo(s.o.appendTo);s.d.wrap=$("<div></div>").attr("tabIndex",-1).addClass("hipmob-modal-wrap").css({height:"100%",outline:0,width:"100%"}).appendTo(s.d.container);s.d.data=data.attr("id",data.attr("id")||s.o.dataId).addClass("hipmob-modal-data").css($.extend(s.o.dataCss,{display:"none"})).appendTo("body");data=null;s.setContainerDimensions();s.d.data.appendTo(s.d.wrap);if(browser.ie6||browser.ieQuirks){s.fixIE()}},bindEvents:function(){var s=this;$("."+s.o.closeClass).bind("click.hipmobmodal",function(e){e.preventDefault();s.close()});if(s.o.modal&&s.o.close&&s.o.overlayClose){s.d.overlay.bind("click.hipmobmodal",function(e){e.preventDefault();s.close()})}doc.bind("keydown.hipmobmodal",function(e){if(s.o.modal&&e.keyCode===9){s.watchTab(e)}else if(s.o.close&&s.o.escClose&&e.keyCode===27){e.preventDefault();s.close()}});wndw.bind("resize.hipmobmodal orientationchange.hipmobmodal",function(){s.getDimensions();s.o.autoResize?s.setContainerDimensions():s.o.autoPosition&&s.setPosition();if(browser.ie6||browser.ieQuirks){s.fixIE()}else if(s.o.modal){s.d.iframe&&s.d.iframe.css({height:w[0],width:w[1]});s.d.overlay.css({height:d[0],width:d[1]})}})},unbindEvents:function(){$("."+this.o.closeClass).unbind("click.hipmobmodal");doc.unbind("keydown.hipmobmodal");wndw.unbind(".hipmobmodal");this.d.overlay.unbind("click.hipmobmodal")},fixIE:function(){var s=this,p=s.o.position;$.each([s.d.iframe||null,!s.o.modal?null:s.d.overlay,s.d.container.css("position")==="fixed"?s.d.container:null],function(i,el){if(el){var bch="document.body.clientHeight",bcw="document.body.clientWidth",bsh="document.body.scrollHeight",bsl="document.body.scrollLeft",bst="document.body.scrollTop",bsw="document.body.scrollWidth",ch="document.documentElement.clientHeight",cw="document.documentElement.clientWidth",sl="document.documentElement.scrollLeft",st="document.documentElement.scrollTop",s=el[0].style;s.position="absolute";if(i<2){s.removeExpression("height");s.removeExpression("width");s.setExpression("height",""+bsh+" > "+bch+" ? "+bsh+" : "+bch+' + "px"');s.setExpression("width",""+bsw+" > "+bcw+" ? "+bsw+" : "+bcw+' + "px"')}else{var te,le;if(p&&p.constructor===Array){var top=p[0]?typeof p[0]==="number"?p[0].toString():p[0].replace(/px/,""):el.css("top").replace(/px/,"");te=top.indexOf("%")===-1?top+" + (t = "+st+" ? "+st+" : "+bst+') + "px"':parseInt(top.replace(/%/,""))+" * (("+ch+" || "+bch+") / 100) + (t = "+st+" ? "+st+" : "+bst+') + "px"';if(p[1]){var left=typeof p[1]==="number"?p[1].toString():p[1].replace(/px/,"");le=left.indexOf("%")===-1?left+" + (t = "+sl+" ? "+sl+" : "+bsl+') + "px"':parseInt(left.replace(/%/,""))+" * (("+cw+" || "+bcw+") / 100) + (t = "+sl+" ? "+sl+" : "+bsl+') + "px"'}}else{te="("+ch+" || "+bch+") / 2 - (this.offsetHeight / 2) + (t = "+st+" ? "+st+" : "+bst+') + "px"';le="("+cw+" || "+bcw+") / 2 - (this.offsetWidth / 2) + (t = "+sl+" ? "+sl+" : "+bsl+') + "px"'}s.removeExpression("top");s.removeExpression("left");s.setExpression("top",te);s.setExpression("left",le)}}})},focus:function(pos){var s=this,p=pos&&$.inArray(pos,["first","last"])!==-1?pos:"first";var input=$(":input:enabled:visible:"+p,s.d.wrap);setTimeout(function(){input.length>0?input.focus():s.d.wrap.focus()},10)},getDimensions:function(){var s=this,h=typeof window.innerHeight==="undefined"?wndw.height():window.innerHeight;d=[doc.height(),doc.width()];w=[h,wndw.width()]},getVal:function(v,d){return v?typeof v==="number"?v:v==="auto"?0:v.indexOf("%")>0?parseInt(v.replace(/%/,""))/100*(d==="h"?w[0]:w[1]):parseInt(v.replace(/px/,"")):null},update:function(height,width){var s=this;if(!s.d.data){return false}s.d.origHeight=s.getVal(height,"h");s.d.origWidth=s.getVal(width,"w");s.d.data.hide();height&&s.d.container.css("height",height);width&&s.d.container.css("width",width);s.setContainerDimensions();s.d.data.show();s.o.focus&&s.focus();s.unbindEvents();s.bindEvents()},setContainerDimensions:function(){var s=this,badIE=browser.ie6||browser.ie7;var ch=s.d.origHeight?s.d.origHeight:browser.opera?s.d.container.height():s.getVal(badIE?s.d.container[0].currentStyle["height"]:s.d.container.css("height"),"h"),cw=s.d.origWidth?s.d.origWidth:browser.opera?s.d.container.width():s.getVal(badIE?s.d.container[0].currentStyle["width"]:s.d.container.css("width"),"w"),dh=s.d.data.outerHeight(true),dw=s.d.data.outerWidth(true);s.d.origHeight=s.d.origHeight||ch;s.d.origWidth=s.d.origWidth||cw;var mxoh=s.o.maxHeight?s.getVal(s.o.maxHeight,"h"):null,mxow=s.o.maxWidth?s.getVal(s.o.maxWidth,"w"):null,mh=mxoh&&mxoh<w[0]?mxoh:w[0],mw=mxow&&mxow<w[1]?mxow:w[1];var moh=s.o.minHeight?s.getVal(s.o.minHeight,"h"):"auto";if(!ch){if(!dh){ch=moh}else{if(dh>mh){ch=mh}else if(s.o.minHeight&&moh!=="auto"&&dh<moh){ch=moh}else{ch=dh}}}else{ch=s.o.autoResize&&ch>mh?mh:ch<moh?moh:ch}var mow=s.o.minWidth?s.getVal(s.o.minWidth,"w"):"auto";if(!cw){if(!dw){cw=mow}else{if(dw>mw){cw=mw}else if(s.o.minWidth&&mow!=="auto"&&dw<mow){cw=mow}else{cw=dw}}}else{cw=s.o.autoResize&&cw>mw?mw:cw<mow?mow:cw}s.d.container.css({height:ch,width:cw});s.d.wrap.css({overflow:dh>ch||dw>cw?"auto":"visible"});s.o.autoPosition&&s.setPosition()},setPosition:function(){var s=this,top,left,hc=w[0]/2-s.d.container.outerHeight(true)/2,vc=w[1]/2-s.d.container.outerWidth(true)/2,st=s.d.container.css("position")!=="fixed"?wndw.scrollTop():0;if(s.o.position&&Object.prototype.toString.call(s.o.position)==="[object Array]"){top=st+(s.o.position[0]||hc);left=s.o.position[1]||vc}else{top=st+hc;left=vc}s.d.container.css({left:left,top:top})},watchTab:function(e){var s=this;if($(e.target).parents(".hipmob-modal-container").length>0){s.inputs=$(":input:enabled:visible:first, :input:enabled:visible:last",s.d.data[0]);if(!e.shiftKey&&e.target===s.inputs[s.inputs.length-1]||e.shiftKey&&e.target===s.inputs[0]||s.inputs.length===0){e.preventDefault();var pos=e.shiftKey?"last":"first";s.focus(pos)}}else{e.preventDefault();s.focus()}},open:function(){var s=this;s.d.iframe&&s.d.iframe.show();if($.isFunction(s.o.onOpen)){s.o.onOpen.apply(s,[s.d])}else{s.d.overlay.show();s.d.container.show();s.d.data.show()}s.o.focus&&s.focus();s.bindEvents()},close:function(){var s=this;if(!s.d.data){return false}s.unbindEvents();if($.isFunction(s.o.onClose)&&!s.occb){s.occb=true;s.o.onClose.apply(s,[s.d])}else{if(s.d.placeholder){var ph=$("#hipmob-modal-placeholder");if(s.o.persist){ph.replaceWith(s.d.data.removeClass("hipmob-modal-data").css("display",s.display))}else{s.d.data.hide().remove();ph.replaceWith(s.d.orig)}}else{s.d.data.hide().remove()}s.d.container.hide().remove();s.d.overlay.hide();s.d.iframe&&s.d.iframe.hide().remove();s.d.overlay.remove();s.d={}}}}};var startup=function(){var hm=new Hipmob("load");q=hm.get_wrench();self["cookie"]=q.cookie;self["update_notification_settings"]=function(settings){q.extend(notification_settings,settings)};setup_modal(q);(function($){$.fn.autofill=function(options){var defaults={value:"First Name",defaultTextColor:"#b2adad",activeTextColor:"#333"};var options=$.extend(defaults,options);return this.each(function(){var obj=$(this);obj.css({color:options.defaultTextColor}).val(options.value).focus(function(){if(obj.val()==options.value){obj.val("").css({color:options.activeTextColor})}}).blur(function(){if(obj.val()==""){obj.css({color:options.defaultTextColor}).val(options.value)}})})}})(q);(function($){$.fn.cancelZoom=function(){return this.each(cancelZoom)}})(q);(function($){$.titleAlert=function(text,settings){if($.titleAlert._running)$.titleAlert.stop();$.titleAlert._settings=settings=$.extend({},$.titleAlert.defaults,settings);if(settings.requireBlur&&$.titleAlert.hasFocus)return;settings.originalTitleInterval=settings.originalTitleInterval||settings.interval;$.titleAlert._running=true;$.titleAlert._initialText=document.title;document.title=text;var showingAlertTitle=true;var switchTitle=function(){if(!$.titleAlert._running)return;showingAlertTitle=!showingAlertTitle;document.title=showingAlertTitle?text:$.titleAlert._initialText;$.titleAlert._intervalToken=setTimeout(switchTitle,showingAlertTitle?settings.interval:settings.originalTitleInterval)
};$.titleAlert._intervalToken=setTimeout(switchTitle,settings.interval);if(settings.stopOnMouseMove){$(document).mousemove(function(event){$(this).unbind(event);$.titleAlert.stop()})}if(settings.duration>0){$.titleAlert._timeoutToken=setTimeout(function(){$.titleAlert.stop()},settings.duration)}};$.titleAlert.defaults={interval:500,originalTitleInterval:null,duration:0,stopOnFocus:true,requireBlur:false,stopOnMouseMove:false};$.titleAlert.stop=function(){if(!$.titleAlert._running)return;clearTimeout($.titleAlert._intervalToken);clearTimeout($.titleAlert._timeoutToken);document.title=$.titleAlert._initialText;$.titleAlert._timeoutToken=null;$.titleAlert._intervalToken=null;$.titleAlert._initialText=null;$.titleAlert._running=false;$.titleAlert._settings=null};$.titleAlert.hasFocus=true;$.titleAlert._running=false;$.titleAlert._intervalToken=null;$.titleAlert._timeoutToken=null;$.titleAlert._initialText=null;$.titleAlert._settings=null;$.titleAlert._focus=function(){$.titleAlert.hasFocus=true;if($.titleAlert._running&&$.titleAlert._settings.stopOnFocus){var initialText=$.titleAlert._initialText;$.titleAlert.stop();setTimeout(function(){if($.titleAlert._running)return;document.title=".";document.title=initialText},1e3)}};$.titleAlert._blur=function(){$.titleAlert.hasFocus=false};$(window).bind("focus",$.titleAlert._focus);$(window).bind("blur",$.titleAlert._blur)})(q);if(!loaded)q(window).on("load",function(){loaded=true});q(function(){load_css((page_secure?"https://":"http://")+asset_host+"/assets/css/chatstyling.min.css",load_hipmob)})};return self}();